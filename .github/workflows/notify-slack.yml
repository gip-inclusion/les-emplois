name: ðŸ“¢ Notify Slack of changed PR

on:
  pull_request:
    types: [closed]

jobs:
  notify:
    # https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#running-your-pull_request-workflow-when-a-pull-request-merges
    if: >
      github.event.pull_request.merged == true
      && !contains(github.event.pull_request.labels.*.name, 'dependencies')
    runs-on: ubuntu-latest
    permissions: {}
    steps:
      - name: "ðŸ“¢ Notify the #mep-c1 channel"
        # Can't use `!contains(...)` because it give us a "tag suffix cannot contain flow indicator characters" error.
        # Oddly enough, using `if: > !contains(...)` works...
        if: contains(github.event.pull_request.labels.*.name, 'no-changelog') == false
        uses: slackapi/slack-github-action@b0fa283ad8fea605de13dc3f449259339835fc52 # v2.1.0
        with:
          webhook: ${{ secrets.SLACK_MEP_C1_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            text: >-
              ${{ format('<{0}|{1}>', github.event.pull_request.html_url, github.event.pull_request.title) }}
      - name: "ðŸ“¢ Notify the #mep-c2 channel"
        if: contains(github.event.pull_request.labels.*.name, 'pilotage')
        uses: slackapi/slack-github-action@b0fa283ad8fea605de13dc3f449259339835fc52 # v2.1.0
        with:
          webhook: ${{ secrets.SLACK_MEP_C2_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            text: >-
              ${{ format('<{0}|{1}>', github.event.pull_request.html_url, github.event.pull_request.title) }}
