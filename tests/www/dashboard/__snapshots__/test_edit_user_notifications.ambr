# serializer version: 1
# name: test_employer_allowed[view queries]
  dict({
    'num_queries': 12,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "companies_companymembership"."id",
                 "companies_companymembership"."user_id",
                 "companies_companymembership"."joined_at",
                 "companies_companymembership"."is_admin",
                 "companies_companymembership"."is_active",
                 "companies_companymembership"."created_at",
                 "companies_companymembership"."updated_at",
                 "companies_companymembership"."company_id",
                 "companies_companymembership"."updated_by_id"
          FROM "companies_companymembership"
          WHERE ("companies_companymembership"."user_id" = %s
                 AND "companies_companymembership"."is_active")
          ORDER BY "companies_companymembership"."created_at" ASC
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "companies_company"."id",
                 "companies_company"."address_line_1",
                 "companies_company"."address_line_2",
                 "companies_company"."post_code",
                 "companies_company"."city",
                 "companies_company"."department",
                 "companies_company"."coords",
                 "companies_company"."geocoding_score",
                 "companies_company"."geocoding_updated_at",
                 "companies_company"."ban_api_resolved_address",
                 "companies_company"."insee_city_id",
                 "companies_company"."name",
                 "companies_company"."created_at",
                 "companies_company"."updated_at",
                 "companies_company"."uid",
                 "companies_company"."active_members_email_reminder_last_sent_at",
                 "companies_company"."automatic_geocoding_update",
                 "companies_company"."siret",
                 "companies_company"."naf",
                 "companies_company"."kind",
                 "companies_company"."brand",
                 "companies_company"."phone",
                 "companies_company"."email",
                 "companies_company"."auth_email",
                 "companies_company"."website",
                 "companies_company"."description",
                 "companies_company"."provided_support",
                 "companies_company"."source",
                 "companies_company"."created_by_id",
                 "companies_company"."block_job_applications",
                 "companies_company"."job_applications_blocked_at",
                 "companies_company"."spontaneous_applications_open_since",
                 "companies_company"."convention_id",
                 "companies_company"."job_app_score",
                 "companies_company"."is_searchable",
                 "companies_company"."rdv_solidarites_id",
                 EXISTS
            (SELECT %s AS "a"
             FROM "companies_siaeconvention" U0
             WHERE (U0."deactivated_at" >= %s
                    AND U0."id" = ("companies_company"."convention_id"))
             LIMIT 1) AS "has_convention_in_grace_period",
                 "companies_siaeconvention"."id",
                 "companies_siaeconvention"."kind",
                 "companies_siaeconvention"."siret_signature",
                 "companies_siaeconvention"."is_active",
                 "companies_siaeconvention"."deactivated_at",
                 "companies_siaeconvention"."reactivated_by_id",
                 "companies_siaeconvention"."reactivated_at",
                 "companies_siaeconvention"."asp_id",
                 "companies_siaeconvention"."created_at",
                 "companies_siaeconvention"."updated_at"
          FROM "companies_company"
          INNER JOIN "companies_companymembership" ON ("companies_company"."id" = "companies_companymembership"."company_id")
          LEFT OUTER JOIN "companies_siaeconvention" ON ("companies_company"."convention_id" = "companies_siaeconvention"."id")
          WHERE (NOT ("companies_company"."siret" = %s)
                 AND "companies_companymembership"."user_id" = %s
                 AND "companies_company"."id" IN (%s)
                 AND (NOT ("companies_company"."kind" IN (%s,
                                                          %s,
                                                          %s,
                                                          %s,
                                                          %s))
                      OR "companies_company"."source" = %s
                      OR EXISTS
                        (SELECT %s AS "a"
                         FROM "companies_siaeconvention" U0
                         WHERE (U0."id" = ("companies_company"."convention_id")
                                AND U0."is_active")
                         LIMIT 1)
                      OR EXISTS
                        (SELECT %s AS "a"
                         FROM "companies_siaeconvention" U0
                         WHERE (U0."deactivated_at" >= %s
                                AND U0."id" = ("companies_company"."convention_id"))
                         LIMIT 1)))
          ORDER BY RANDOM() ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" = %s
                 AND "communications_notificationsettings"."structure_type_id" = %s)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'Company.has_admin[common_apps/organizations/models.py]',
          'User.can_create_siae_antenna[users/models.py]',
          'can_create_antenna[utils/templatetags/can_create_antenna.py]',
          'SimpleNode[layout/_header_authenticated.html]',
          'IncludeNode[layout/base.html]',
          'IfNode[layout/base.html]',
          'ExtendsNode[dashboard/edit_user_notifications.html]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT %s AS "a"
          FROM "users_user"
          INNER JOIN "companies_companymembership" ON ("users_user"."id" = "companies_companymembership"."user_id")
          WHERE ("companies_companymembership"."id" IN
                   (SELECT U0."id"
                    FROM "companies_companymembership" U0
                    INNER JOIN "users_user" U2 ON (U0."user_id" = U2."id")
                    WHERE (U0."company_id" = %s
                           AND U2."is_active"
                           AND U0."is_active"
                           AND U0."is_admin"
                           AND U2."is_active"))
                 AND "users_user"."id" = %s)
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'Company.has_admin[common_apps/organizations/models.py]',
          'Company.convention_can_be_accessed_by[companies/models.py]',
          'nav[utils/templatetags/nav.py]',
          'InclusionNode[layout/_header_authenticated.html]',
          'IncludeNode[layout/base.html]',
          'IfNode[layout/base.html]',
          'ExtendsNode[dashboard/edit_user_notifications.html]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT %s AS "a"
          FROM "users_user"
          INNER JOIN "companies_companymembership" ON ("users_user"."id" = "companies_companymembership"."user_id")
          WHERE ("companies_companymembership"."id" IN
                   (SELECT U0."id"
                    FROM "companies_companymembership" U0
                    INNER JOIN "users_user" U2 ON (U0."user_id" = U2."id")
                    WHERE (U0."company_id" = %s
                           AND U2."is_active"
                           AND U0."is_active"
                           AND U0."is_admin"
                           AND U2."is_active"))
                 AND "users_user"."id" = %s)
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Session.save[<site-packages>/django/db/models/base.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          UPDATE "django_session"
          SET "session_data" = %s,
              "expire_date" = %s
          WHERE "django_session"."session_key" = %s
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
# name: test_employer_create_update_notification_settings[view queries - disable all notifications]
  dict({
    'num_queries': 22,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "companies_companymembership"."id",
                 "companies_companymembership"."user_id",
                 "companies_companymembership"."joined_at",
                 "companies_companymembership"."is_admin",
                 "companies_companymembership"."is_active",
                 "companies_companymembership"."created_at",
                 "companies_companymembership"."updated_at",
                 "companies_companymembership"."company_id",
                 "companies_companymembership"."updated_by_id"
          FROM "companies_companymembership"
          WHERE ("companies_companymembership"."user_id" = %s
                 AND "companies_companymembership"."is_active")
          ORDER BY "companies_companymembership"."created_at" ASC
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "companies_company"."id",
                 "companies_company"."address_line_1",
                 "companies_company"."address_line_2",
                 "companies_company"."post_code",
                 "companies_company"."city",
                 "companies_company"."department",
                 "companies_company"."coords",
                 "companies_company"."geocoding_score",
                 "companies_company"."geocoding_updated_at",
                 "companies_company"."ban_api_resolved_address",
                 "companies_company"."insee_city_id",
                 "companies_company"."name",
                 "companies_company"."created_at",
                 "companies_company"."updated_at",
                 "companies_company"."uid",
                 "companies_company"."active_members_email_reminder_last_sent_at",
                 "companies_company"."automatic_geocoding_update",
                 "companies_company"."siret",
                 "companies_company"."naf",
                 "companies_company"."kind",
                 "companies_company"."brand",
                 "companies_company"."phone",
                 "companies_company"."email",
                 "companies_company"."auth_email",
                 "companies_company"."website",
                 "companies_company"."description",
                 "companies_company"."provided_support",
                 "companies_company"."source",
                 "companies_company"."created_by_id",
                 "companies_company"."block_job_applications",
                 "companies_company"."job_applications_blocked_at",
                 "companies_company"."spontaneous_applications_open_since",
                 "companies_company"."convention_id",
                 "companies_company"."job_app_score",
                 "companies_company"."is_searchable",
                 "companies_company"."rdv_solidarites_id",
                 EXISTS
            (SELECT %s AS "a"
             FROM "companies_siaeconvention" U0
             WHERE (U0."deactivated_at" >= %s
                    AND U0."id" = ("companies_company"."convention_id"))
             LIMIT 1) AS "has_convention_in_grace_period",
                 "companies_siaeconvention"."id",
                 "companies_siaeconvention"."kind",
                 "companies_siaeconvention"."siret_signature",
                 "companies_siaeconvention"."is_active",
                 "companies_siaeconvention"."deactivated_at",
                 "companies_siaeconvention"."reactivated_by_id",
                 "companies_siaeconvention"."reactivated_at",
                 "companies_siaeconvention"."asp_id",
                 "companies_siaeconvention"."created_at",
                 "companies_siaeconvention"."updated_at"
          FROM "companies_company"
          INNER JOIN "companies_companymembership" ON ("companies_company"."id" = "companies_companymembership"."company_id")
          LEFT OUTER JOIN "companies_siaeconvention" ON ("companies_company"."convention_id" = "companies_siaeconvention"."id")
          WHERE (NOT ("companies_company"."siret" = %s)
                 AND "companies_companymembership"."user_id" = %s
                 AND "companies_company"."id" IN (%s)
                 AND (NOT ("companies_company"."kind" IN (%s,
                                                          %s,
                                                          %s,
                                                          %s,
                                                          %s))
                      OR "companies_company"."source" = %s
                      OR EXISTS
                        (SELECT %s AS "a"
                         FROM "companies_siaeconvention" U0
                         WHERE (U0."id" = ("companies_company"."convention_id")
                                AND U0."is_active")
                         LIMIT 1)
                      OR EXISTS
                        (SELECT %s AS "a"
                         FROM "companies_siaeconvention" U0
                         WHERE (U0."deactivated_at" >= %s
                                AND U0."id" = ("companies_company"."convention_id"))
                         LIMIT 1)))
          ORDER BY RANDOM() ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" = %s
                 AND "communications_notificationsettings"."structure_type_id" = %s)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT ("communications_disablednotification"."settings_id") AS "_prefetch_related_val_settings_id",
                 "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" IN (%s))
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."structure_pk" = %s
                 AND "communications_notificationsettings"."structure_type_id" = %s
                 AND "communications_notificationsettings"."user_id" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_disablednotification"."notification_record_id"
          FROM "communications_disablednotification"
          WHERE ("communications_disablednotification"."notification_record_id" IN (%s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s)
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY RANDOM() ASC
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          INSERT INTO "communications_disablednotification" ("notification_record_id",
                                                             "settings_id",
                                                             "disabled_at")
          VALUES (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s) RETURNING "communications_disablednotification"."id"
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
# name: test_employer_create_update_notification_settings[view queries - enable all notifications]
  dict({
    'num_queries': 15,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "companies_companymembership"."id",
                 "companies_companymembership"."user_id",
                 "companies_companymembership"."joined_at",
                 "companies_companymembership"."is_admin",
                 "companies_companymembership"."is_active",
                 "companies_companymembership"."created_at",
                 "companies_companymembership"."updated_at",
                 "companies_companymembership"."company_id",
                 "companies_companymembership"."updated_by_id"
          FROM "companies_companymembership"
          WHERE ("companies_companymembership"."user_id" = %s
                 AND "companies_companymembership"."is_active")
          ORDER BY "companies_companymembership"."created_at" ASC
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "companies_company"."id",
                 "companies_company"."address_line_1",
                 "companies_company"."address_line_2",
                 "companies_company"."post_code",
                 "companies_company"."city",
                 "companies_company"."department",
                 "companies_company"."coords",
                 "companies_company"."geocoding_score",
                 "companies_company"."geocoding_updated_at",
                 "companies_company"."ban_api_resolved_address",
                 "companies_company"."insee_city_id",
                 "companies_company"."name",
                 "companies_company"."created_at",
                 "companies_company"."updated_at",
                 "companies_company"."uid",
                 "companies_company"."active_members_email_reminder_last_sent_at",
                 "companies_company"."automatic_geocoding_update",
                 "companies_company"."siret",
                 "companies_company"."naf",
                 "companies_company"."kind",
                 "companies_company"."brand",
                 "companies_company"."phone",
                 "companies_company"."email",
                 "companies_company"."auth_email",
                 "companies_company"."website",
                 "companies_company"."description",
                 "companies_company"."provided_support",
                 "companies_company"."source",
                 "companies_company"."created_by_id",
                 "companies_company"."block_job_applications",
                 "companies_company"."job_applications_blocked_at",
                 "companies_company"."spontaneous_applications_open_since",
                 "companies_company"."convention_id",
                 "companies_company"."job_app_score",
                 "companies_company"."is_searchable",
                 "companies_company"."rdv_solidarites_id",
                 EXISTS
            (SELECT %s AS "a"
             FROM "companies_siaeconvention" U0
             WHERE (U0."deactivated_at" >= %s
                    AND U0."id" = ("companies_company"."convention_id"))
             LIMIT 1) AS "has_convention_in_grace_period",
                 "companies_siaeconvention"."id",
                 "companies_siaeconvention"."kind",
                 "companies_siaeconvention"."siret_signature",
                 "companies_siaeconvention"."is_active",
                 "companies_siaeconvention"."deactivated_at",
                 "companies_siaeconvention"."reactivated_by_id",
                 "companies_siaeconvention"."reactivated_at",
                 "companies_siaeconvention"."asp_id",
                 "companies_siaeconvention"."created_at",
                 "companies_siaeconvention"."updated_at"
          FROM "companies_company"
          INNER JOIN "companies_companymembership" ON ("companies_company"."id" = "companies_companymembership"."company_id")
          LEFT OUTER JOIN "companies_siaeconvention" ON ("companies_company"."convention_id" = "companies_siaeconvention"."id")
          WHERE (NOT ("companies_company"."siret" = %s)
                 AND "companies_companymembership"."user_id" = %s
                 AND "companies_company"."id" IN (%s)
                 AND (NOT ("companies_company"."kind" IN (%s,
                                                          %s,
                                                          %s,
                                                          %s,
                                                          %s))
                      OR "companies_company"."source" = %s
                      OR EXISTS
                        (SELECT %s AS "a"
                         FROM "companies_siaeconvention" U0
                         WHERE (U0."id" = ("companies_company"."convention_id")
                                AND U0."is_active")
                         LIMIT 1)
                      OR EXISTS
                        (SELECT %s AS "a"
                         FROM "companies_siaeconvention" U0
                         WHERE (U0."deactivated_at" >= %s
                                AND U0."id" = ("companies_company"."convention_id"))
                         LIMIT 1)))
          ORDER BY RANDOM() ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" = %s
                 AND "communications_notificationsettings"."structure_type_id" = %s)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."structure_pk" = %s
                 AND "communications_notificationsettings"."structure_type_id" = %s
                 AND "communications_notificationsettings"."user_id" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettings.save[<site-packages>/django/db/models/base.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          INSERT INTO "communications_notificationsettings" ("user_id",
                                                             "structure_type_id",
                                                             "structure_pk")
          VALUES (%s, %s, %s) RETURNING "communications_notificationsettings"."id"
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Session.save[<site-packages>/django/db/models/base.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          UPDATE "django_session"
          SET "session_data" = %s,
              "expire_date" = %s
          WHERE "django_session"."session_key" = %s
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
# name: test_job_seeker_allowed[view queries]
  dict({
    'num_queries': 8,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" IS NULL
                 AND "communications_notificationsettings"."structure_type_id" IS NULL)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Session.save[<site-packages>/django/db/models/base.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          UPDATE "django_session"
          SET "session_data" = %s,
              "expire_date" = %s
          WHERE "django_session"."session_key" = %s
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
# name: test_job_seeker_create_update_notification_settings[view queries - disable all notifications]
  dict({
    'num_queries': 16,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" IS NULL
                 AND "communications_notificationsettings"."structure_type_id" IS NULL)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT ("communications_disablednotification"."settings_id") AS "_prefetch_related_val_settings_id",
                 "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" IN (%s))
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."structure_pk" IS NULL
                 AND "communications_notificationsettings"."structure_type_id" IS NULL
                 AND "communications_notificationsettings"."user_id" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_disablednotification"."notification_record_id"
          FROM "communications_disablednotification"
          WHERE ("communications_disablednotification"."notification_record_id" IN (%s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s)
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY RANDOM() ASC
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          INSERT INTO "communications_disablednotification" ("notification_record_id",
                                                             "settings_id",
                                                             "disabled_at")
          VALUES (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s) RETURNING "communications_disablednotification"."id"
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
# name: test_job_seeker_create_update_notification_settings[view queries - enable all notifications]
  dict({
    'num_queries': 10,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" IS NULL
                 AND "communications_notificationsettings"."structure_type_id" IS NULL)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."structure_pk" IS NULL
                 AND "communications_notificationsettings"."structure_type_id" IS NULL
                 AND "communications_notificationsettings"."user_id" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettings.save[<site-packages>/django/db/models/base.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          INSERT INTO "communications_notificationsettings" ("user_id",
                                                             "structure_type_id",
                                                             "structure_pk")
          VALUES (%s, %s, %s) RETURNING "communications_notificationsettings"."id"
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
# name: test_prescriber_allowed[view queries]
  dict({
    'num_queries': 10,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "prescribers_prescribermembership"."id",
                 "prescribers_prescribermembership"."user_id",
                 "prescribers_prescribermembership"."joined_at",
                 "prescribers_prescribermembership"."is_admin",
                 "prescribers_prescribermembership"."is_active",
                 "prescribers_prescribermembership"."created_at",
                 "prescribers_prescribermembership"."updated_at",
                 "prescribers_prescribermembership"."organization_id",
                 "prescribers_prescribermembership"."updated_by_id",
                 "prescribers_prescriberorganization"."id",
                 "prescribers_prescriberorganization"."address_line_1",
                 "prescribers_prescriberorganization"."address_line_2",
                 "prescribers_prescriberorganization"."post_code",
                 "prescribers_prescriberorganization"."city",
                 "prescribers_prescriberorganization"."department",
                 "prescribers_prescriberorganization"."coords",
                 "prescribers_prescriberorganization"."geocoding_score",
                 "prescribers_prescriberorganization"."geocoding_updated_at",
                 "prescribers_prescriberorganization"."ban_api_resolved_address",
                 "prescribers_prescriberorganization"."insee_city_id",
                 "prescribers_prescriberorganization"."name",
                 "prescribers_prescriberorganization"."created_at",
                 "prescribers_prescriberorganization"."updated_at",
                 "prescribers_prescriberorganization"."uid",
                 "prescribers_prescriberorganization"."active_members_email_reminder_last_sent_at",
                 "prescribers_prescriberorganization"."automatic_geocoding_update",
                 "prescribers_prescriberorganization"."siret",
                 "prescribers_prescriberorganization"."is_head_office",
                 "prescribers_prescriberorganization"."kind",
                 "prescribers_prescriberorganization"."is_brsa",
                 "prescribers_prescriberorganization"."phone",
                 "prescribers_prescriberorganization"."email",
                 "prescribers_prescriberorganization"."website",
                 "prescribers_prescriberorganization"."description",
                 "prescribers_prescriberorganization"."code_safir_pole_emploi",
                 "prescribers_prescriberorganization"."created_by_id",
                 "prescribers_prescriberorganization"."authorization_status",
                 "prescribers_prescriberorganization"."authorization_updated_at",
                 "prescribers_prescriberorganization"."authorization_updated_by_id"
          FROM "prescribers_prescribermembership"
          INNER JOIN "prescribers_prescriberorganization" ON ("prescribers_prescribermembership"."organization_id" = "prescribers_prescriberorganization"."id")
          WHERE ("prescribers_prescribermembership"."user_id" = %s
                 AND "prescribers_prescribermembership"."is_active")
          ORDER BY "prescribers_prescribermembership"."created_at" ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" = %s
                 AND "communications_notificationsettings"."structure_type_id" = %s)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'nav[utils/templatetags/nav.py]',
          'InclusionNode[layout/_header_authenticated.html]',
          'IncludeNode[layout/base.html]',
          'IfNode[layout/base.html]',
          'ExtendsNode[dashboard/edit_user_notifications.html]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT COUNT(*) AS "__count"
          FROM "prescribers_prescribermembership"
          WHERE "prescribers_prescribermembership"."organization_id" = %s
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Session.save[<site-packages>/django/db/models/base.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          UPDATE "django_session"
          SET "session_data" = %s,
              "expire_date" = %s
          WHERE "django_session"."session_key" = %s
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
# name: test_prescriber_create_update_notification_settings[view queries - disable all notifications]
  dict({
    'num_queries': 17,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "prescribers_prescribermembership"."id",
                 "prescribers_prescribermembership"."user_id",
                 "prescribers_prescribermembership"."joined_at",
                 "prescribers_prescribermembership"."is_admin",
                 "prescribers_prescribermembership"."is_active",
                 "prescribers_prescribermembership"."created_at",
                 "prescribers_prescribermembership"."updated_at",
                 "prescribers_prescribermembership"."organization_id",
                 "prescribers_prescribermembership"."updated_by_id",
                 "prescribers_prescriberorganization"."id",
                 "prescribers_prescriberorganization"."address_line_1",
                 "prescribers_prescriberorganization"."address_line_2",
                 "prescribers_prescriberorganization"."post_code",
                 "prescribers_prescriberorganization"."city",
                 "prescribers_prescriberorganization"."department",
                 "prescribers_prescriberorganization"."coords",
                 "prescribers_prescriberorganization"."geocoding_score",
                 "prescribers_prescriberorganization"."geocoding_updated_at",
                 "prescribers_prescriberorganization"."ban_api_resolved_address",
                 "prescribers_prescriberorganization"."insee_city_id",
                 "prescribers_prescriberorganization"."name",
                 "prescribers_prescriberorganization"."created_at",
                 "prescribers_prescriberorganization"."updated_at",
                 "prescribers_prescriberorganization"."uid",
                 "prescribers_prescriberorganization"."active_members_email_reminder_last_sent_at",
                 "prescribers_prescriberorganization"."automatic_geocoding_update",
                 "prescribers_prescriberorganization"."siret",
                 "prescribers_prescriberorganization"."is_head_office",
                 "prescribers_prescriberorganization"."kind",
                 "prescribers_prescriberorganization"."is_brsa",
                 "prescribers_prescriberorganization"."phone",
                 "prescribers_prescriberorganization"."email",
                 "prescribers_prescriberorganization"."website",
                 "prescribers_prescriberorganization"."description",
                 "prescribers_prescriberorganization"."code_safir_pole_emploi",
                 "prescribers_prescriberorganization"."created_by_id",
                 "prescribers_prescriberorganization"."authorization_status",
                 "prescribers_prescriberorganization"."authorization_updated_at",
                 "prescribers_prescriberorganization"."authorization_updated_by_id"
          FROM "prescribers_prescribermembership"
          INNER JOIN "prescribers_prescriberorganization" ON ("prescribers_prescribermembership"."organization_id" = "prescribers_prescriberorganization"."id")
          WHERE ("prescribers_prescribermembership"."user_id" = %s
                 AND "prescribers_prescribermembership"."is_active")
          ORDER BY "prescribers_prescribermembership"."created_at" ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" = %s
                 AND "communications_notificationsettings"."structure_type_id" = %s)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT ("communications_disablednotification"."settings_id") AS "_prefetch_related_val_settings_id",
                 "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" IN (%s))
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."structure_pk" = %s
                 AND "communications_notificationsettings"."structure_type_id" = %s
                 AND "communications_notificationsettings"."user_id" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_disablednotification"."notification_record_id"
          FROM "communications_disablednotification"
          WHERE ("communications_disablednotification"."notification_record_id" IN (%s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s)
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY RANDOM() ASC
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          INSERT INTO "communications_disablednotification" ("notification_record_id",
                                                             "settings_id",
                                                             "disabled_at")
          VALUES (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s) RETURNING "communications_disablednotification"."id"
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
# name: test_prescriber_create_update_notification_settings[view queries - enable all notifications]
  dict({
    'num_queries': 14,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "prescribers_prescribermembership"."id",
                 "prescribers_prescribermembership"."user_id",
                 "prescribers_prescribermembership"."joined_at",
                 "prescribers_prescribermembership"."is_admin",
                 "prescribers_prescribermembership"."is_active",
                 "prescribers_prescribermembership"."created_at",
                 "prescribers_prescribermembership"."updated_at",
                 "prescribers_prescribermembership"."organization_id",
                 "prescribers_prescribermembership"."updated_by_id",
                 "prescribers_prescriberorganization"."id",
                 "prescribers_prescriberorganization"."address_line_1",
                 "prescribers_prescriberorganization"."address_line_2",
                 "prescribers_prescriberorganization"."post_code",
                 "prescribers_prescriberorganization"."city",
                 "prescribers_prescriberorganization"."department",
                 "prescribers_prescriberorganization"."coords",
                 "prescribers_prescriberorganization"."geocoding_score",
                 "prescribers_prescriberorganization"."geocoding_updated_at",
                 "prescribers_prescriberorganization"."ban_api_resolved_address",
                 "prescribers_prescriberorganization"."insee_city_id",
                 "prescribers_prescriberorganization"."name",
                 "prescribers_prescriberorganization"."created_at",
                 "prescribers_prescriberorganization"."updated_at",
                 "prescribers_prescriberorganization"."uid",
                 "prescribers_prescriberorganization"."active_members_email_reminder_last_sent_at",
                 "prescribers_prescriberorganization"."automatic_geocoding_update",
                 "prescribers_prescriberorganization"."siret",
                 "prescribers_prescriberorganization"."is_head_office",
                 "prescribers_prescriberorganization"."kind",
                 "prescribers_prescriberorganization"."is_brsa",
                 "prescribers_prescriberorganization"."phone",
                 "prescribers_prescriberorganization"."email",
                 "prescribers_prescriberorganization"."website",
                 "prescribers_prescriberorganization"."description",
                 "prescribers_prescriberorganization"."code_safir_pole_emploi",
                 "prescribers_prescriberorganization"."created_by_id",
                 "prescribers_prescriberorganization"."authorization_status",
                 "prescribers_prescriberorganization"."authorization_updated_at",
                 "prescribers_prescriberorganization"."authorization_updated_by_id"
          FROM "prescribers_prescribermembership"
          INNER JOIN "prescribers_prescriberorganization" ON ("prescribers_prescribermembership"."organization_id" = "prescribers_prescriberorganization"."id")
          WHERE ("prescribers_prescribermembership"."user_id" = %s
                 AND "prescribers_prescribermembership"."is_active")
          ORDER BY "prescribers_prescribermembership"."created_at" ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" = %s
                 AND "communications_notificationsettings"."structure_type_id" = %s)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."structure_pk" = %s
                 AND "communications_notificationsettings"."structure_type_id" = %s
                 AND "communications_notificationsettings"."user_id" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettings.save[<site-packages>/django/db/models/base.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          INSERT INTO "communications_notificationsettings" ("user_id",
                                                             "structure_type_id",
                                                             "structure_pk")
          VALUES (%s, %s, %s) RETURNING "communications_notificationsettings"."id"
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Session.save[<site-packages>/django/db/models/base.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          UPDATE "django_session"
          SET "session_data" = %s,
              "expire_date" = %s
          WHERE "django_session"."session_key" = %s
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
# name: test_solo_adviser_allowed[view queries]
  dict({
    'num_queries': 9,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "prescribers_prescribermembership"."id",
                 "prescribers_prescribermembership"."user_id",
                 "prescribers_prescribermembership"."joined_at",
                 "prescribers_prescribermembership"."is_admin",
                 "prescribers_prescribermembership"."is_active",
                 "prescribers_prescribermembership"."created_at",
                 "prescribers_prescribermembership"."updated_at",
                 "prescribers_prescribermembership"."organization_id",
                 "prescribers_prescribermembership"."updated_by_id",
                 "prescribers_prescriberorganization"."id",
                 "prescribers_prescriberorganization"."address_line_1",
                 "prescribers_prescriberorganization"."address_line_2",
                 "prescribers_prescriberorganization"."post_code",
                 "prescribers_prescriberorganization"."city",
                 "prescribers_prescriberorganization"."department",
                 "prescribers_prescriberorganization"."coords",
                 "prescribers_prescriberorganization"."geocoding_score",
                 "prescribers_prescriberorganization"."geocoding_updated_at",
                 "prescribers_prescriberorganization"."ban_api_resolved_address",
                 "prescribers_prescriberorganization"."insee_city_id",
                 "prescribers_prescriberorganization"."name",
                 "prescribers_prescriberorganization"."created_at",
                 "prescribers_prescriberorganization"."updated_at",
                 "prescribers_prescriberorganization"."uid",
                 "prescribers_prescriberorganization"."active_members_email_reminder_last_sent_at",
                 "prescribers_prescriberorganization"."automatic_geocoding_update",
                 "prescribers_prescriberorganization"."siret",
                 "prescribers_prescriberorganization"."is_head_office",
                 "prescribers_prescriberorganization"."kind",
                 "prescribers_prescriberorganization"."is_brsa",
                 "prescribers_prescriberorganization"."phone",
                 "prescribers_prescriberorganization"."email",
                 "prescribers_prescriberorganization"."website",
                 "prescribers_prescriberorganization"."description",
                 "prescribers_prescriberorganization"."code_safir_pole_emploi",
                 "prescribers_prescriberorganization"."created_by_id",
                 "prescribers_prescriberorganization"."authorization_status",
                 "prescribers_prescriberorganization"."authorization_updated_at",
                 "prescribers_prescriberorganization"."authorization_updated_by_id"
          FROM "prescribers_prescribermembership"
          INNER JOIN "prescribers_prescriberorganization" ON ("prescribers_prescribermembership"."organization_id" = "prescribers_prescriberorganization"."id")
          WHERE ("prescribers_prescribermembership"."user_id" = %s
                 AND "prescribers_prescribermembership"."is_active")
          ORDER BY "prescribers_prescribermembership"."created_at" ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" IS NULL
                 AND "communications_notificationsettings"."structure_type_id" IS NULL)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'Session.save[<site-packages>/django/db/models/base.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          UPDATE "django_session"
          SET "session_data" = %s,
              "expire_date" = %s
          WHERE "django_session"."session_key" = %s
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
          'SessionStore.save[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
# name: test_solo_adviser_create_update_notification_settings[view queries - disable all notifications]
  dict({
    'num_queries': 16,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "prescribers_prescribermembership"."id",
                 "prescribers_prescribermembership"."user_id",
                 "prescribers_prescribermembership"."joined_at",
                 "prescribers_prescribermembership"."is_admin",
                 "prescribers_prescribermembership"."is_active",
                 "prescribers_prescribermembership"."created_at",
                 "prescribers_prescribermembership"."updated_at",
                 "prescribers_prescribermembership"."organization_id",
                 "prescribers_prescribermembership"."updated_by_id",
                 "prescribers_prescriberorganization"."id",
                 "prescribers_prescriberorganization"."address_line_1",
                 "prescribers_prescriberorganization"."address_line_2",
                 "prescribers_prescriberorganization"."post_code",
                 "prescribers_prescriberorganization"."city",
                 "prescribers_prescriberorganization"."department",
                 "prescribers_prescriberorganization"."coords",
                 "prescribers_prescriberorganization"."geocoding_score",
                 "prescribers_prescriberorganization"."geocoding_updated_at",
                 "prescribers_prescriberorganization"."ban_api_resolved_address",
                 "prescribers_prescriberorganization"."insee_city_id",
                 "prescribers_prescriberorganization"."name",
                 "prescribers_prescriberorganization"."created_at",
                 "prescribers_prescriberorganization"."updated_at",
                 "prescribers_prescriberorganization"."uid",
                 "prescribers_prescriberorganization"."active_members_email_reminder_last_sent_at",
                 "prescribers_prescriberorganization"."automatic_geocoding_update",
                 "prescribers_prescriberorganization"."siret",
                 "prescribers_prescriberorganization"."is_head_office",
                 "prescribers_prescriberorganization"."kind",
                 "prescribers_prescriberorganization"."is_brsa",
                 "prescribers_prescriberorganization"."phone",
                 "prescribers_prescriberorganization"."email",
                 "prescribers_prescriberorganization"."website",
                 "prescribers_prescriberorganization"."description",
                 "prescribers_prescriberorganization"."code_safir_pole_emploi",
                 "prescribers_prescriberorganization"."created_by_id",
                 "prescribers_prescriberorganization"."authorization_status",
                 "prescribers_prescriberorganization"."authorization_updated_at",
                 "prescribers_prescriberorganization"."authorization_updated_by_id"
          FROM "prescribers_prescribermembership"
          INNER JOIN "prescribers_prescriberorganization" ON ("prescribers_prescribermembership"."organization_id" = "prescribers_prescriberorganization"."id")
          WHERE ("prescribers_prescribermembership"."user_id" = %s
                 AND "prescribers_prescribermembership"."is_active")
          ORDER BY "prescribers_prescribermembership"."created_at" ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" IS NULL
                 AND "communications_notificationsettings"."structure_type_id" IS NULL)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT ("communications_disablednotification"."settings_id") AS "_prefetch_related_val_settings_id",
                 "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" IN (%s))
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."structure_pk" IS NULL
                 AND "communications_notificationsettings"."structure_type_id" IS NULL
                 AND "communications_notificationsettings"."user_id" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id",
                 "communications_notificationrecord"."notification_class",
                 "communications_notificationrecord"."name",
                 "communications_notificationrecord"."category",
                 "communications_notificationrecord"."can_be_disabled",
                 "communications_notificationrecord"."is_obsolete"
          FROM "communications_notificationrecord"
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_notificationrecord"."notification_class" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_disablednotification"."notification_record_id"
          FROM "communications_disablednotification"
          WHERE ("communications_disablednotification"."notification_record_id" IN (%s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s,
                                                                                    %s)
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY RANDOM() ASC
        ''',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          INSERT INTO "communications_disablednotification" ("notification_record_id",
                                                             "settings_id",
                                                             "disabled_at")
          VALUES (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s),
                 (%s, %s, %s) RETURNING "communications_disablednotification"."id"
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
# name: test_solo_adviser_create_update_notification_settings[view queries - enable all notifications]
  dict({
    'num_queries': 11,
    'queries': list([
      dict({
        'origin': list([
          'SessionStore._get_session_from_db[<site-packages>/django/contrib/sessions/backends/db.py]',
        ]),
        'sql': '''
          SELECT "django_session"."session_key",
                 "django_session"."session_data",
                 "django_session"."expire_date"
          FROM "django_session"
          WHERE ("django_session"."expire_date" > %s
                 AND "django_session"."session_key" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "users_user"."id",
                 "users_user"."password",
                 "users_user"."last_login",
                 "users_user"."is_superuser",
                 "users_user"."username",
                 "users_user"."first_name",
                 "users_user"."last_name",
                 "users_user"."is_staff",
                 "users_user"."is_active",
                 "users_user"."date_joined",
                 "users_user"."address_line_1",
                 "users_user"."address_line_2",
                 "users_user"."post_code",
                 "users_user"."city",
                 "users_user"."department",
                 "users_user"."coords",
                 "users_user"."geocoding_score",
                 "users_user"."geocoding_updated_at",
                 "users_user"."ban_api_resolved_address",
                 "users_user"."insee_city_id",
                 "users_user"."title",
                 "users_user"."full_name_search_vector",
                 "users_user"."email",
                 "users_user"."phone",
                 "users_user"."kind",
                 "users_user"."identity_provider",
                 "users_user"."has_completed_welcoming_tour",
                 "users_user"."created_by_id",
                 "users_user"."external_data_source_history",
                 "users_user"."last_checked_at",
                 "users_user"."public_id",
                 "users_user"."address_filled_at",
                 "users_user"."first_login",
                 "users_user"."upcoming_deletion_notified_at"
          FROM "users_user"
          WHERE "users_user"."id" = %s
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'ItouCurrentOrganizationMiddleware.__call__[utils/perms/middleware.py]',
        ]),
        'sql': '''
          SELECT "prescribers_prescribermembership"."id",
                 "prescribers_prescribermembership"."user_id",
                 "prescribers_prescribermembership"."joined_at",
                 "prescribers_prescribermembership"."is_admin",
                 "prescribers_prescribermembership"."is_active",
                 "prescribers_prescribermembership"."created_at",
                 "prescribers_prescribermembership"."updated_at",
                 "prescribers_prescribermembership"."organization_id",
                 "prescribers_prescribermembership"."updated_by_id",
                 "prescribers_prescriberorganization"."id",
                 "prescribers_prescriberorganization"."address_line_1",
                 "prescribers_prescriberorganization"."address_line_2",
                 "prescribers_prescriberorganization"."post_code",
                 "prescribers_prescriberorganization"."city",
                 "prescribers_prescriberorganization"."department",
                 "prescribers_prescriberorganization"."coords",
                 "prescribers_prescriberorganization"."geocoding_score",
                 "prescribers_prescriberorganization"."geocoding_updated_at",
                 "prescribers_prescriberorganization"."ban_api_resolved_address",
                 "prescribers_prescriberorganization"."insee_city_id",
                 "prescribers_prescriberorganization"."name",
                 "prescribers_prescriberorganization"."created_at",
                 "prescribers_prescriberorganization"."updated_at",
                 "prescribers_prescriberorganization"."uid",
                 "prescribers_prescriberorganization"."active_members_email_reminder_last_sent_at",
                 "prescribers_prescriberorganization"."automatic_geocoding_update",
                 "prescribers_prescriberorganization"."siret",
                 "prescribers_prescriberorganization"."is_head_office",
                 "prescribers_prescriberorganization"."kind",
                 "prescribers_prescriberorganization"."is_brsa",
                 "prescribers_prescriberorganization"."phone",
                 "prescribers_prescriberorganization"."email",
                 "prescribers_prescriberorganization"."website",
                 "prescribers_prescriberorganization"."description",
                 "prescribers_prescriberorganization"."code_safir_pole_emploi",
                 "prescribers_prescriberorganization"."created_by_id",
                 "prescribers_prescriberorganization"."authorization_status",
                 "prescribers_prescriberorganization"."authorization_updated_at",
                 "prescribers_prescriberorganization"."authorization_updated_by_id"
          FROM "prescribers_prescribermembership"
          INNER JOIN "prescribers_prescriberorganization" ON ("prescribers_prescribermembership"."organization_id" = "prescribers_prescriberorganization"."id")
          WHERE ("prescribers_prescribermembership"."user_id" = %s
                 AND "prescribers_prescribermembership"."is_active")
          ORDER BY "prescribers_prescribermembership"."created_at" ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettingsQuerySet.first[<site-packages>/django/db/models/query.py]',
          'EditUserNotificationForm.__init__[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."user_id" = %s
                 AND "communications_notificationsettings"."structure_pk" IS NULL
                 AND "communications_notificationsettings"."structure_type_id" IS NULL)
          ORDER BY "communications_notificationsettings"."id" ASC
          LIMIT 1
        ''',
      }),
      dict({
        'origin': list([
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationsettings"."id",
                 "communications_notificationsettings"."user_id",
                 "communications_notificationsettings"."structure_type_id",
                 "communications_notificationsettings"."structure_pk"
          FROM "communications_notificationsettings"
          WHERE ("communications_notificationsettings"."structure_pk" IS NULL
                 AND "communications_notificationsettings"."structure_type_id" IS NULL
                 AND "communications_notificationsettings"."user_id" = %s)
          LIMIT 21
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__enter__[<site-packages>/django/db/transaction.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': 'SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'NotificationSettings.save[<site-packages>/django/db/models/base.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          INSERT INTO "communications_notificationsettings" ("user_id",
                                                             "structure_type_id",
                                                             "structure_pk")
          VALUES (%s, %s, %s) RETURNING "communications_notificationsettings"."id"
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
          'get_or_create[communications/models.py]',
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
      dict({
        'origin': list([
          'EditUserNotificationForm.save[www/dashboard/forms.py]',
          'edit_user_notifications[www/dashboard/views.py]',
        ]),
        'sql': '''
          SELECT "communications_notificationrecord"."id"
          FROM "communications_notificationrecord"
          INNER JOIN "communications_disablednotification" ON ("communications_notificationrecord"."id" = "communications_disablednotification"."notification_record_id")
          WHERE (NOT ("communications_notificationrecord"."is_obsolete")
                 AND "communications_disablednotification"."settings_id" = %s)
          ORDER BY "communications_notificationrecord"."category" ASC,
                   "communications_notificationrecord"."name" ASC
        ''',
      }),
      dict({
        'origin': list([
          'Atomic.__exit__[<site-packages>/django/db/transaction.py]',
        ]),
        'sql': 'RELEASE SAVEPOINT "<snapshot>"',
      }),
    ]),
  })
# ---
