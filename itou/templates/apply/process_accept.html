{% extends "apply/process_base.html" %}
{% load bootstrap4 %}
{% load static %}
{% load str_filters %}

{% block content_extend %}
    <div class="alert alert-info">
        <p class="mb-0">Confirmez votre choix en renseignant quelques informations supplémentaires.</p>
    </div>

    {% include "apply/includes/job_application_accept_form.html" %}

    <div class="modal" id="js-confirmation-modal" tabindex="-1" aria-labelledby="confirmation-modal-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content modal-centered">
                <div class="modal-header">
                    <h3 class="modal-title" id="confirmation-modal-label">Confirmation de l’embauche</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
                        <i class="ri-close-line"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p>
                        Êtes-vous sûr(e) de vouloir confirmer l’embauche de <strong>{{ job_application.job_seeker.get_full_name }}</strong> dans la structure suivante ?
                    </p>
                    {% include "siaes/includes/_siae_info.html" with siae=job_application.to_siae %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Retour</button>
                    <button class="btn btn-primary" hx-post={{ request.path }} hx-vals='{"confirmed": "True"}' hx-include="#acceptForm">Confirmer
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    {{ block.super }}

    <script src="{% static 'js/split_nir.js' %}"></script>

    <!-- Needed to use the Datepicker JS widget. -->
    {{ form_accept.media }}
    {% if form_personal_data %}{{ form_personal_data.media }}{% endif %}

    {# HTMX: dynamic contract type details field, must be reloaded at each DOM swap (otherwise invalidated) #}
    <script nonce="{{ CSP_NONCE }}">
        htmx.onLoad(function() {
            var contractType = $("#id_contract_type");
            var contractTypeDetails = $("#contractTypeDetails");
            contractType.change(function() {
                if (contractType.val() == '{{ hide_value }}') {
                    contractTypeDetails.removeClass("d-none");
                } else {
                    $("#id_contract_type_details").val('');
                    contractTypeDetails.addClass("d-none");
                }
            });
        });
    </script>
{% endblock %}
