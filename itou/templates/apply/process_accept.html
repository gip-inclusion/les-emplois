{% extends "apply/process_base.html" %}
{% load bootstrap4 %}

{% block content %}

    {{ block.super }}

    <div class="alert alert-info">
        <p class="mb-0">Confirmez votre choix en renseignant quelques informations supplémentaires.</p>
    </div>

    {% block htmx %}
        <form method="post"
              action=""
              hx-post="{{ request.path }}"
              hx-swap="outerHTML show:#acceptForm:top"
              class="mt-5"
              id="acceptForm"
              tabindex="0"
              aria-labelledby="dialogLabel"
              aria-hidden="true"
              {% if modal_shown %}data-htmx-open-modal="#js-confirmation-modal"{% endif %}>
            {% if has_form_error %}
                <div class="alert alert-danger">
                    <p class="mb-0">Merci de corriger les erreurs ci-dessous</p>
                </div>
            {% endif %}

            {% csrf_token %}

            {% if form_address or form_personal_data %}<h3 class="h2">Candidat</h3>{% endif %}

            {% if form_personal_data %}
                {% bootstrap_form form_personal_data alert_error_type="all" %}
            {% endif %}


            {% if form_user_address %}
                {% bootstrap_form form_user_address alert_error_type="all" %}
            {% endif %}

            <div class="mt-5">

                <h3 class="h2">Embauche</h3>
                {% bootstrap_form form_accept alert_error_type="all" %}

            </div>

            <hr class="my-5">
            {% buttons %}
                <div class="text-right mb-4">
                    <a class="btn btn-outline-primary bg-white" href="{% url 'apply:details_for_siae' job_application_id=job_application.id %}">Retour</a>
                    <button type="submit" class="btn btn-primary btn-ico">
                        <i class="ri-check-line ri-xl"></i><span class=".btn .btn-ico"></span>Valider l’embauche
                    </button>
                </div>
            {% endbuttons %}

        </form>
    {% endblock %}

    <div class="modal" id="js-confirmation-modal" tabindex="-1" aria-labelledby="confirmation-modal-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content modal-centered">
                <div class="modal-header">
                    <h3 class="modal-title" id="confirmation-modal-label">Confirmation de l’embauche</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
                        <i class="ri-close-line"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p>
                        Êtes-vous sûr(e) de vouloir confirmer l’embauche de <strong>{{ job_application.job_seeker.first_name }} {{ job_application.job_seeker.last_name }}</strong> dans la structure suivante ?
                    </p>
                    <p>{% include "siaes/includes/_siae_info.html" with siae=job_application.to_siae %}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Retour</button>
                    <button type="submit" class="btn btn-primary" hx-post={{ request.path }} hx-vals='{"confirmed": "True"}' hx-include="#acceptForm">Confirmer
                    </button>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block script %}
    {{ block.super }}
    <!-- Needed to use the Datepicker JS widget. -->
    {{ form_accept.media }}
    {% if form_personal_data %}{{ form_personal_data.media }}{% endif %}
{% endblock %}
