{% extends "layout/content_small.html" %}

{% block title %}
    Candidature
    -
    {{ job_application.job_seeker.get_full_name }}
    {{ block.super }}
{% endblock %}

{% block content %}

    <h1 class="h1-hero-c1">
        Candidature de
        <span class="text-muted">{{ job_application.job_seeker.get_full_name|title }}</span>
    </h1>
    <p class="h2">{% include "apply/includes/state_badge.html" with job_application=job_application %}</p>

    {% if job_application.to_siae.is_subject_to_eligibility_rules %}

        {% if job_application.state.is_accepted %}

            <div class="card my-3">
                <div class="card-body">

                    {# Approval status. #}
                    <div class="card-text">
                        {% if job_application.approval %}
                            {% include "approvals/includes/status.html" with approval=job_application.approval %}
                        {% elif job_application.hiring_without_approval %}
                            Vous n'avez pas demandé de PASS IAE (agrément).
                        {% elif job_application.approval_manually_refused_at %}
                            PASS IAE refusé (délai de carence non respecté).
                        {% else %}
                            PASS IAE (agrément) en cours de délivrance.
                        {% endif %}
                    </div>

                    {# Approval actions. #}
                    {% if job_application.approval and request.user.is_siae_staff %}
                        {% if approval_can_be_suspended_by_siae %}
                            <a
                                href="{% url 'approvals:suspend' approval_id=job_application.approval.id %}?back_url={{ request.get_full_path|urlencode }}"
                                class="btn btn-link">
                                Suspendre
                            </a>
                        {% elif hire_by_other_siae %}
                            <span class="btn btn-link disabled text-muted">Suspendre</span>
                            <i
                                class="ri-information-line ri-xl text-info"
                                data-toggle="tooltip"
                                title="La suspension n’est pas possible, un autre employeur a embauché le candidat.">
                            </i>
                        {% endif %}
                        {% if approval_can_be_prolonged_by_siae %}
                            <a
                                href="{% url 'approvals:declare_prolongation' approval_id=job_application.approval.id %}?back_url={{ request.get_full_path|urlencode }}"
                                class="btn btn-link">
                                Prolonger
                            </a>
                        {% endif %}
                        {% if job_application.can_display_approval %}
                            <a
                                class="btn btn-outline-primary float-right matomo-event"
                                data-matomo-action="telechargement-pdf"
                                data-matomo-category="agrement"
                                data-matomo-option="details-candidature"
                                href="{% url 'approvals:display_printable_approval' job_application_id=job_application.id %}"
                                target="_blank">
                                Afficher le PASS IAE
                            </a>
                        {% endif %}
                    {% endif %}

                </div>
            </div>

        {% elif not job_application.state.is_cancelled and approvals_wrapper.latest_approval %}

            <div class="card my-3">
                <div class="card-body">
                    {# Approval status. #}
                    <div class="card-text">
                        {# Employers need to know the expiration date of an approval #}
                        {# to decide whether they may accept a job application or not. #}
                        {% include "approvals/includes/status.html" with approval=approvals_wrapper.latest_approval job_application=job_application %}
                    </div>
                </div>
            </div>

        {% endif %}

    {% endif %}

{% endblock %}
