{% extends "layout/base.html" %}
{% load django_bootstrap5 %}
{% load static %}
{% load str_filters %}
{% load matomo %}
{% load theme_inclusion %}

{% block title %}Candidatures envoyées {{ block.super }}{% endblock %}

{% block breadcrumbs %}
    {% include "layout/previous_step.html" with back_url=back_url only %}
{% endblock %}

{% block content_title %}
    <div class="d-flex flex-column flex-md-row gap-3 justify-content-md-between">
        <h1 class="m-0">Candidatures envoyées</h1>
        <div class="d-flex flex-column flex-md-row gap-3" role="group" aria-label="Actions sur les candidatures">
            {% include "apply/includes/job_applications_export_button.html" %}
            <a href="{% url 'search:employers_home' %}" class="btn btn-lg btn-primary btn-ico">
                <i class="ri-draft-line font-weight-medium" aria-hidden="true"></i>
                <span>Postuler pour un candidat</span>
            </a>
        </div>
    </div>
{% endblock %}

{% block messages %}
    {{ block.super }}
    {% if request.user.is_prescriber_with_authorized_org %}
        <div id="authorized-prescribers-survey-about-autonomous-candidates" class="alert alert-important alert-dismissible-once d-none" role="status">
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
            <div class="row">
                <div class="d-none d-md-inline col-md-auto">
                    <img src="{% static_theme_images "ico-bicro-important.svg" %}" alt="" height="80">
                </div>
                <div class="col-12 col-md px-md-0">
                    <p class="mb-2">
                        <strong>Votre avis sur l’expérience candidat nous intéresse !</strong>
                    </p>
                    <p class="mb-0">
                        Dites-nous en plus sur vos pratiques vis-à-vis des candidats qui postulent en autonomie.
                        Prenez 5 min pour répondre à notre enquête.
                    </p>
                </div>
                <div class="col-12 col-md-auto mt-3 mt-md-0 d-flex align-items-center justify-content-center">
                    <a href="https://tally.so/r/3xdblE" class="btn btn-sm btn-primary btn-ico" target="_blank" rel="noopener"><span>Répondre à l’enquête</span><i class="ri-external-link-line font-weight-medium" aria-hidden="true"></i></a>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block content %}
    <section class="s-box">
        <div class="s-box__container container">
            <div class="s-box__row row">
                <div class="col-12 col-md-4 mb-3 mb-md-5">
                    <aside class="c-aside-filters">
                        <button class="c-aside-filters__btn__collapse" data-bs-toggle="collapse" data-bs-target="#asideFiltersCollapse" aria-expanded="true" aria-controls="asideFiltersCollapse">
                            <i class="ri-filter-line" aria-hidden="true"></i>
                            <span>Filtrer les candidatures</span>
                        </button>
                        <div class="c-aside-filters__card collapse show" id="asideFiltersCollapse">
                            <form hx-get="{% url 'apply:list_prescriptions' %}"
                                  hx-trigger="change delay:.5s, duetChange delay:.5s"
                                  hx-indicator="#job-applications-section"
                                  hx-target="#job-applications-section"
                                  hx-swap="outerHTML"
                                  hx-push-url="true">
                                <div class="c-aside-filters__card__body">
                                    {% include "apply/includes/job_applications_filters/status.html" %}
                                    {% include "apply/includes/job_applications_filters/job_seekers.html" %}
                                    {% include "apply/includes/job_applications_filters/to_companies.html" %}
                                    {% include "apply/includes/job_applications_filters/sender.html" %}
                                    {% include "apply/includes/job_applications_filters/dates.html" %}
                                    {% include "apply/includes/job_applications_filters/selected_jobs.html" %}
                                    {% include "apply/includes/job_applications_filters/pass.html" %}
                                    {% include "apply/includes/job_applications_filters/eligibility_validated.html" %}
                                    {% include "apply/includes/job_applications_filters/criteria.html" %}
                                    {% include "apply/includes/job_applications_filters/departments.html" %}
                                </div>
                            </form>
                        </div>
                    </aside>
                </div>
                <div class="col-12 col-md-8">
                    {% include "apply/includes/list_job_applications.html" with job_applications_page=job_applications_page job_applications_list_kind=job_applications_list_kind JobApplicationsListKind=JobApplicationsListKind filters_counter=filters_counter request=request list_exports_url=list_exports_url SenderKind=SenderKind only %}
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block script %}
    {{ block.super }}
    <!-- Needed to use Select2MultipleWidget. -->
    {{ filters_form.media.js }}
    <script src='{% static "js/htmx_compat.js" %}'></script>
{% endblock %}
