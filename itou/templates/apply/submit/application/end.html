{% extends "layout/base.html" %}
{% load django_bootstrap5 %}
{% load format_filters %}
{% load str_filters %}
{% load buttons_form %}

{% block title %}Création du compte candidat {{ block.super }}{% endblock %}

{% block content_title %}
    <h1>{{ auto_prescription_process|yesno:"Auto-prescription enregistrée !,Candidature envoyée !" }}</h1>
    <p>
        {% if request.user.is_job_seeker %}
            Votre candidature
        {% else %}
            La candidature de {{ job_application.job_seeker.get_full_name|mask_unless:can_view_personal_information }}
        {% endif %}
        <b>a bien été envoyée chez {{ job_application.to_company.display_name }}</b>.
    </p>
{% endblock %}

{% block content %}
    <section class="s-section-twocolumns s-section">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-8 js-swap-elements">
                    {% if can_view_personal_information %}
                        <p>
                            <b>
                                {% if can_edit_personal_information %}
                                    Veuillez vous assurer que {{ request.user.is_job_seeker|yesno:"vos coordonnées,les coordonnées de votre candidat" }} sont bien à jour :
                                {% else %}
                                    Le candidat a la possibilité de mettre à jour ses coordonnées en se connectant sur son espace.
                                {% endif %}
                            </b>
                        </p>
                        <div id="informations" {% if form.is_bound %}class="d-none"{% endif %} data-swap-element-with=".c-form">
                            <div class="card c-card c-card--noshadow border-bottom p-3">
                                <div class="card-header d-flex flex-row align-items-center">
                                    <h2 class="mb-0 flex-grow-1">{{ job_application.job_seeker.get_full_name }}</h2>
                                    {% if request.user.is_job_seeker %}
                                        <a class="btn btn-outline-primary btn-ico btn-sm" href="{% url 'dashboard:edit_user_info' %}">
                                            <i class="ri-pencil-line"></i>
                                            <span>Modifier</span>
                                        </a>
                                    {% elif can_edit_personal_information %}
                                        <span class="btn btn-outline-primary btn-ico btn-sm" data-swap-element="#informations">
                                            <i class="ri-pencil-line"></i>
                                            <span>Modifier</span>
                                        </span>
                                    {% endif %}
                                </div>
                                <div class="card-body">
                                    <hr>
                                    <p>
                                        <span class="text-muted">Adresse</span>
                                        <br />
                                        <b>{{ job_application.job_seeker.address_on_one_line|default:"Non renseigné" }}</b>
                                        <br />
                                    </p>
                                    <hr>
                                    <p>
                                        <span class="text-muted">N&deg; de téléphone</span>
                                        <br />
                                        {% if job_application.job_seeker.phone %}
                                            <b>{{ job_application.job_seeker.phone|format_phone }}</b>
                                        {% elif request.user.is_job_seeker %}
                                            <b>Non renseigné</b>
                                            <p class="text-warning fst-italic">
                                                L’ajout du numéro de téléphone permet à l’employeur de vous contacter plus facilement.
                                            </p>
                                        {% else %}
                                            <b>Non renseigné</b>
                                            <p class="text-warning fst-italic">L’ajout du numéro de téléphone facilitera la prise de contact avec le candidat.</p>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                            <div class="form-row align-items-center justify-content-end gx-3 mt-3">
                                <div class="form-group col-6 col-lg-auto">
                                    <a class="btn btn-primary btn-block" href="{% url "dashboard:index" %}">Tableau de bord</a>
                                </div>
                            </div>
                        </div>
                        {% if not request.user.is_job_seeker %}
                            <div class="c-form c-card--noshadow border-bottom {% if not form.is_bound %}d-none{% endif %}" data-swap-element-with="#informations">
                                <h2 class="mb-5">{{ job_application.job_seeker.get_full_name }}</h2>

                                <form method="post">
                                    {% csrf_token %}
                                    <fieldset>
                                        {% bootstrap_field form.address_for_autocomplete %}
                                        {% bootstrap_field form.address_line_1 %}
                                        {% bootstrap_field form.address_line_2 %}
                                        {% bootstrap_field form.post_code %}
                                        {% bootstrap_field form.city %}

                                        {% bootstrap_field form.insee_code %}
                                        {% bootstrap_field form.ban_api_resolved_address %}
                                        {% bootstrap_field form.fill_mode %}
                                        {% bootstrap_field form.phone %}
                                    </fieldset>

                                    {% itou_buttons_form primary_label="Enregistrer" reset_url=reset_url %}
                                </form>
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="form-row align-items-center justify-content-end gx-3 mt-3">
                            <div class="form-group col-6 col-lg-auto">
                                <a class="btn btn-primary btn-block" href="{% url "dashboard:index" %}">Tableau de bord</a>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block script %}
    {{ block.super }}
    {% comment %} Needed for the AddressAutocompleteWidget {% endcomment %}
    {{ form.media.js }}
{% endblock %}
