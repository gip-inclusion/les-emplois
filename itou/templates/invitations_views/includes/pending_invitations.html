<div class="c-box mt-3 mt-md-5">
    <h3 class="h4">Invitations en attente</h3>
    <div class="alert alert-warning">
        <p>
            Chaque collaborateur invité reçoit son propre lien d'invitation, ce lien est valable 15 jours (lorsque le lien expire, l'invitation n'est plus affichée ci-dessus).
            Ce lien d'invitation est transmis automatiquement par e-mail.
        </p>
        <p class="mb-0">En cas de besoin, vous pouvez également le copier depuis la colonne « Lien d'invitation ».</p>
    </div>

    <div class="table-responsive-lg mt-3">
        <table class="table">
            <caption class="sr-only">Liste des invitations en attente</caption>
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Nom</th>
                    <th scope="col">Email</th>
                    <th scope="col">Envoyée le</th>
                    <th scope="col">Lien d'invitation</th>
                </tr>
            </thead>
            <tbody>
                {% for invitation in pending_invitations %}
                    <tr>
                        <th scope="row">{{ forloop.counter }}</th>
                        <td>{{ invitation.first_name }} {{ invitation.last_name }}</td>
                        <td>
                            <a href="mailto:{{ invitation.email }}">{{ invitation.email }}</a>
                        </td>
                        <td>{{ invitation.sent_at|date:"d F Y à H:i" }}</td>
                        <td>
                            <p>
                                <a data-toggle="collapse" href="#share-invitation-link-{{ forloop.counter }}" role="button" aria-expanded="false">
                                    Afficher le lien
                                </a>
                            </p>
                            <div class="collapse form-group invitation-link" id="share-invitation-link-{{ forloop.counter }}">
                                <p>Cliquez sur le lien ci-dessous pour le copier:</p>
                                <input type="text" class="form-control" readonly="readonly" value="{{ invitation.acceptance_link }}">
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<script nonce="{{ CSP_NONCE }}">
    var links = document.getElementsByClassName('invitation-link')
    for (var i = 0, j = links.length; i < j; i++) {
        links[i].addEventListener("click", function select(event) {
            var input = event.target.querySelector('input');
            input.select();
            navigator.clipboard.writeText(input.value);
        });
    }
</script>
