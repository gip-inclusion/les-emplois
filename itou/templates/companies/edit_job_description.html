{% extends "layout/base.html" %}
{% load static %}
{% load django_bootstrap5 %}
{% load matomo %}

{% block title %}Enregistrer une fiche de poste {{ block.super }}{% endblock %}

{% block breadcrumbs %}
    {% include "layout/breadcrumbs_from_dashboard.html" %}
{% endblock %}

{% block content_title_wrapper %}{% endblock %}

{% block content %}
    <section class="s-section">
        <div class="s-section__container container">
            <div class="row">
                <div class="col-12 col-lg-8">
                    <div class="c-stepper mb-3 mb-lg-5">
                        <div class="progress progress--emploi">
                            <div class="progress-bar progress-bar-33" role="progressbar" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100">
                            </div>
                        </div>
                        <p>
                            <strong>Étape 1</strong>/3 : Informations générales
                        </p>
                    </div>

                    <div class="c-form">
                        <div class="text-center mb-3 mb-lg-5">
                            <div class="mb-2">
                                <img src="{% static 'img/edit_job_description_header.svg' %}" alt="">
                            </div>
                            <h1>
                                Informations générales
                                <br class="d-none d-lg-inline">
                                de ma fiche de poste
                            </h1>
                        </div>

                        <form method="post" class="js-prevent-multiple-submit">
                            {% bootstrap_form_errors form alert_error_type="all" %}

                            {% csrf_token %}

                            {# Not using compact form because of `other_contract_type` field dynamic behaviour #}
                            {% bootstrap_field form.appellation %}
                            {% bootstrap_field form.custom_name %}
                            {% bootstrap_field form.location %}
                            {% if form.market_context_description %}
                                {% bootstrap_field form.market_context_description %}
                            {% endif %}
                            {% bootstrap_field form.contract_type %}
                            <div id="_other_contract_type_group">{% bootstrap_field form.other_contract_type %}</div>
                            {% bootstrap_field form.hours_per_week %}
                            {% bootstrap_field form.open_positions %}
                            <hr>
                            <div class="form-row align-items-center gx-3">
                                <div class="form-group col-12 col-lg order-2 order-lg-1">
                                    <a href="{% url "companies_views:job_description_list" %}" class="btn btn-link btn-ico ps-lg-0 w-100 w-lg-auto" aria-label="Retourner à la liste des métiers">
                                        <i class="ri-arrow-go-back-line ri-lg"></i>
                                        <span>Retour</span>
                                    </a>
                                </div>
                                <div class="form-group col-12 col-lg-auto order-1 order-lg-2">
                                    <button class="btn btn-primary btn-block" aria-label="Passer à l'étape suivante" {% matomo_event "employeurs" "submit" "edit-infos-fiche-poste" %}>
                                        Suivant
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block script %}
    {{ block.super }}
    <script nonce="{{ CSP_NONCE }}">
        function disable_other_contract_type() {
            var isDisabled = $("#id_contract_type").val() !== "OTHER"
            $("#id_other_contract_type").attr("disabled", isDisabled)
            if (isDisabled) {
                $("#id_other_contract_type").val("")
                $("#_other_contract_type_group").hide()
            } else {
                $("#_other_contract_type_group").show()
            }
        }
        // When page is loaded, do:
        disable_other_contract_type()
        // Then, on any change:
        $("#id_contract_type").change(disable_other_contract_type)
    </script>
{% endblock %}
