{% load bootstrap4 %}
{% load static %}

<h4>Récapitulatif et validation de la fiche salarié</h4>

{% with profile=employee_record.job_seeker_profile  employee=employee_record.job_seeker %}
<div class="card bg-light my-4 p-4">

    <h5>Etat civil</h5>

    <div class="py-2">
        <div>
            {{ employee.get_title_display }} {{ employee.get_full_name }} 
        </div>
        <div>
            Né(e) le : {{ employee.birthdate }}
        </div>
        <div>
            {% if employee.birth_place %}
                A : {{ employee.birth_place }} ({{ employee.birth_place.department_code }})
            {% endif %}
        </div>
        <div>
            Pays de naissance : {{ employee.birth_country }} 
        </div>
    </div>

    <h5>Domiciliation</h5>

    <div class="py-2">
        {{ profile.hexa_address_display }}
    </div>

    <h5>Situation du salarié</h5>

    <div class="py-2">
        <div>{{ profile.get_education_level_display }}</div>

        {% if profile.pole_emploi_since %}
            <div>
                Inscrit à Pôle emploi depuis {{ profile.get_pole_emploi_since_display|lower }} ({{ employee.pole_emploi_id }})
            </div>
        {% endif %}

        {% if profile.resourceless %}
            <div>Le salarié ne dispose d'aucune ressource</div>
        {% endif %} 

        {% if profile.oeth_employee %}
            <div>Employé OETH</div>
        {% endif %}
        
        {% if profile.rqth_employee %}
            <div>Employé RQTH</div>
        {% endif %}

        {% if profile.rsa_allocation_since %}
            <div>
                {{ profile.get_has_rsa_allocation_display }} (depuis {{ profile.get_rsa_allocation_since_display|lower }})
            </div>
        {% endif %}
        
        {% if profile.ass_allocation_since %}
            <div>
                Bénéficiaire de l'ASS depuis (depuis {{ profile.get_ass_allocation_since_display|lower }})
            </div>
        {% endif %}

        {% if profile.aah_allocation_since %}
            <div>
                Bénéficiaire de l'AAH depuis (depuis {{ profile.get_aah_allocation_since_display|lower }})
            </div>
        {% endif %}

        {% if profile.ata_allocation_since %}
            <div>
                Bénéficiaire de l'ATA depuis (depuis {{ profile.get_ata_allocation_since_display|lower }})
            </div>
        {% endif %}

    </div>

    <h5>Annexe financière </h5>

    <div>    
        {{ employee_record.financial_annex.number }} ({{ employee_record.financial_annex.get_state_display|lower }})
    </div>

</div>
{% endwith %}

{% if employee_record.status == 'NEW' %}
    <div class="alert alert-warning">
        <p>Si ce récapitulatif et conforme et complet, la fiche salarié sera envoyée pour validation à l'ASP.</p>
        <p>
            Le traitement est effectué à intervalle régulier et vous serez notifié du changement d'état
            de la fiche salarié sur la liste récapitulative accessible depuis le tableau de bord.
        </p>
    </div>

    <form method="POST" action="{% url "employee_record_views:create_step_5" job_application.id %}" class="js-prevent-multiple-submit">
        {% csrf_token %}
        {% buttons %}
            <a class="btn btn-outline-secondary" href="{% url "employee_record_views:create_step_4" job_application.id %}">Précédent</a>
            <button type="submit" class="btn btn-primary">Valider la fiche salarié</button>
        {% endbuttons %}
    </form>

    {% else %}
        <div class="alert alert-warning">
            <p>La création de cette fiche salariée est maintenant terminée .</p>
            <p>Vous pouvez suivre l'avancement de son traitement par l'ASP via la liste récapitulative accessible depuis le tableau de bord.</p>
        </div>

        <a href="{% url "employee_record_views:list" %}" class="btn btn-primary">
            Retour à la liste des fiches salarié
        </a>
    {% endif %}
