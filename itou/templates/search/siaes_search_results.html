{% extends "layout/content.html" %}

{% block title %}
    {% if form.is_valid %}
        Employeurs solidaires à {{ distance }} km du centre de {{ city }}
    {% else %}
        Recherche d'employeurs solidaires
    {% endif %}
    {{ block.super }}
{% endblock %}

{% block script %}
    {{ block.super }}
    <script nonce="{{ CSP_NONCE }}">
        $("#search-filter-form :input").change(function() {
            $("#search-form").submit();
        });
        // If the Filtres button is present, the associated card should be collapsed on display.
        if ($("#js-search-filter-button").is(":visible")) {
            // The button should be always visible now (on windows resize)
            $("#js-search-filter-button").removeClass("d-md-none");
            $('#search-filter-form').collapse();
        }
        $("#siae-number-results").focus();
        // FIXME(vperron): Remove this after March 2023; especially it might break the display if the number
        // or order of the contract types filter changes.
        $("#id_contract_types > div:nth-child(12) > label:nth-child(1)").append('<span class="badge badge-base badge-xs badge-pill badge-important ml-1 text-white">Nouveau</span>');
    </script>
{% endblock %}

{% block content %}
    <section class="s-tabs-01 mx-md-1 mx-lg-2">
        <form id="search-form" method="get" action="" class="d-block mb-5">
            {% include "search/includes/siaes_search_form.html" with form=form %}

            {% if form.is_valid %}
                <h2 class="h2">
                    Emplois inclusifs à <strong>{{ distance }} km</strong> du centre de <strong>{{ city }}</strong>
                </h2>
            {% endif %}

            <ul class="nav nav-tabs nav-tabs--emploi">
                <li class="nav-item">
                    <a class="matomo-event nav-link {% if request.resolver_match.view_name == "search:siaes_results" %}active{% endif %}"
                       data-matomo-category="candidature"
                       data-matomo-action="clic"
                       data-matomo-option="clic-onglet-employeur"
                       href="{% url "search:siaes_results" %}?{{ filters_query_string }}">
                        <i class="ri-hotel-line ri-xl mr-1"></i>
                        Employeurs
                        {% if siaes_count %}
                            <span class="d-lg-none d-xl-none ml-1">({{ siaes_count }})</span>
                            <span class="d-none d-lg-inline ml-1">({{ siaes_count }} résultat{{ siaes_count|pluralize }})</span>
                        {% endif %}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="matomo-event nav-link {% if request.resolver_match.view_name == "search:job_descriptions_results" %}active{% endif %}"
                       data-matomo-category="candidature"
                       data-matomo-action="clic"
                       data-matomo-option="clic-onglet-fichesdeposte"
                       href="{% url "search:job_descriptions_results" %}?{{ filters_query_string }}">
                        <i class="ri-briefcase-4-line ri-xl mr-1"></i>
                        <span class="d-lg-none d-xl-none">Postes</span>
                        <span class="d-none d-lg-inline">Postes ouverts au recrutement</span>
                        {% if job_descriptions_count %}
                            <span class="d-lg-none d-xl-none ml-1">({{ job_descriptions_count }})</span>
                            <span class="d-none d-lg-inline ml-1">
                                ({{ job_descriptions_count }} résultat{{ job_descriptions_count|pluralize }})
                            </span>
                        {% endif %}
                        <div class="d-none d-lg-block">
                            <span class="badge badge-base badge-xs badge-pill badge-important ml-1 text-white">Nouveau</span>
                        </div>
                    </a>
                </li>
            </ul>

            <div class="tab-content py-1">
                <div class="row px-lg-2">
                    <div class="col-12 col-md-4">{% include "search/includes/siaes_search_filters.html" with form=form %}</div>
                    <div class="col-12 col-md-8">
                        {% for item in results_page %}
                            {% if request.resolver_match.view_name == "search:siaes_results" %}
                                {% include "siaes/includes/_card_siae.html" with siae=item %}
                            {% else %}
                                {% include "siaes/includes/_card_jobdescription.html" with job_description=item %}
                            {% endif %}
                        {% empty %}
                            <div class="card my-4">
                                <div class="card-body">
                                    <p>Aucun résultat avec les filtres actuels.</p>
                                </div>
                            </div>
                        {% endfor %}

                        {% include "includes/pagination.html" with page=results_page %}
                    </div>
                </div>
            </div>
        </form>
    </section>

{% endblock %}
