{% extends "layout/content.html" %}

{% block title %}
    {% if form.is_valid %}
        Employeurs solidaires à {{ distance }} km du centre de {{ city }}
    {% else %}
        Recherche d'employeurs solidaires
    {% endif %}
    {{ block.super }}
{% endblock %}

{% block content_container_css_classes %}s-tabs-01 p-0{% endblock %}
{% block content %}
    <div class="s-tabs-01__row row">
        <div class="s-tabs-01__col col-12">
            <form id="search-form" method="get" class="d-block w-100 mb-3 mb-md-5">
                {% include "search/includes/siaes_search_form.html" with form=form %}
                {% if form.is_valid %}
                    <h1 class="h2">
                        Emplois inclusifs à <strong>{{ distance }} km</strong> du centre de <strong>{{ city }}</strong>
                    </h1>
                {% endif %}
                <ul class="s-tabs-01__nav nav nav-tabs">
                    <li class="nav-item" role="presentation">
                        <a class="matomo-event nav-link {% if request.resolver_match.view_name == "search:siaes_results" %}active{% endif %}"
                           data-matomo-category="candidature"
                           data-matomo-action="clic"
                           data-matomo-option="clic-onglet-employeur"
                           href="{% url "search:siaes_results" %}?{{ filters_query_string }}">
                            <i class="ri-hotel-line ri-xl font-weight-normal mr-1"></i>
                            <span>{{ siaes_count }} employeur{{ siaes_count|pluralize }}</span>
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="matomo-event nav-link {% if request.resolver_match.view_name == "search:job_descriptions_results" %}active{% endif %}"
                           data-matomo-category="candidature"
                           data-matomo-action="clic"
                           data-matomo-option="clic-onglet-fichesdeposte"
                           href="{% url "search:job_descriptions_results" %}?{{ filters_query_string }}">
                            <i class="ri-briefcase-4-line ri-xl font-weight-normal mr-1"></i>
                            <span class="d-inline d-lg-none">{{ job_descriptions_count }} poste{{ job_descriptions_count|pluralize }}</span>
                            <span class="d-none d-lg-inline">{{ job_descriptions_count }} poste{{ job_descriptions_count|pluralize }} ouvert{{ job_descriptions_count|pluralize }} au recrutement</span>
                        </a>
                    </li>
                    <li class="nav-item-dropdown dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" id="sTabs01DropdownMoreLink" data-toggle="dropdown" aria-expanded="false"><i class="ri-more-line"></i></a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="sTabs01DropdownMoreLink"></div>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active">
                        <div class="row">
                            <div class="col-12 col-md-4">{% include "search/includes/siaes_search_filters.html" with form=form %}</div>
                            <div class="col-12 col-md-8">
                                {% for item in results_page %}
                                    {% if request.resolver_match.view_name == "search:siaes_results" %}
                                        {% include "siaes/includes/_card_siae.html" with siae=item %}
                                    {% else %}
                                        {% include "siaes/includes/_card_jobdescription.html" with job_description=item %}
                                    {% endif %}
                                {% empty %}
                                    <div class="c-card card mb-3 mb-md-4">
                                        <div class="card-body">
                                            <p>Aucun résultat avec les filtres actuels.</p>
                                        </div>
                                    </div>
                                {% endfor %}

                                {% include "includes/pagination.html" with page=results_page %}
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block script %}
    {{ block.super }}
    <script nonce="{{ CSP_NONCE }}">
        $("#search-filter-form :input").change(function() {
            $("#search-form").submit();
        });

        // Show or Hide the search-filter-form sidebar based on responsive breakpoint
        var breakpointMD = getComputedStyle(document.documentElement).getPropertyValue("--breakpoint-md");
        $(window).on("load resize", function() {
            if (window.matchMedia("(min-width: "+breakpointMD+")").matches) {
                $("#search-filter-form").collapse("show");
            } else {
                $("#search-filter-form").collapse("hide");
            }
        });

        $("#siae-number-results").focus();
        // FIXME(vperron): Remove this after March 2023; especially it might break the display if the number
        // or order of the contract types filter changes.
        $("#id_contract_types > div:nth-child(12) > label:nth-child(1)").append('<span class="badge badge-xs badge-pill badge-important ml-2 text-white">Nouveau</span>');
    </script>
{% endblock %}
