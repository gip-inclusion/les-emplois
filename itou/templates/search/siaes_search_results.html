{% extends "layout/base.html" %}
{% load static %}

{% block title %}
    {% include "search/includes/siaes_search_title.html" %}
    {{ block.super }}
{% endblock %}

{% block content_title %}<h1>Rechercher un emploi inclusif</h1>{% endblock %}

{% block content %}
    <section class="s-tabs-01">
        <div class="s-tabs-01__container container">
            <div class="s-tabs-01__row row">
                <div class="s-tabs-01__col col-12">
                    {% include "search/includes/siaes_search_form.html" with form=form is_home=False only %}
                    {% include "search/includes/siaes_search_tabs.html" %}
                    <div class="tab-content">
                        {% include "search/includes/siaes_search_top.html" %}
                        <form class="d-block w-100"
                              hx-get="{% url request.resolver_match.view_name %}"
                              hx-trigger="change delay:.5s, change from:#id_city"
                              hx-indicator="#job-search-results"
                              hx-target="#job-search-results"
                              hx-swap="outerHTML"
                              hx-include="#id_city"
                              hx-push-url="true">
                            <div class="row">
                                <div class="col-12 col-md-4">{% include "search/includes/siaes_search_filters.html" with form=form %}</div>
                                {% include "search/includes/siaes_search_results.html" %}
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block script %}
    {{ block.super }}
    <script src='{% static "js/htmx_compat.js" %}'></script>
    {# A / B testing: apply to company with job descriptions #}
    <script nonce="{{ CSP_NONCE }}">
        var _paq = _paq || [];
        _paq.push(['AbTesting::create', {
            name: 'PostulerEmployeurAvecMetier',
            percentage: 100,
            includedTargets: [{
                "attribute": "path",
                "inverted": "0",
                "type": "starts_with",
                "value": "\/search\/employers\/results"
            }],
            excludedTargets: [],
            variations: [{
                name: 'original',
                activate: function() {}
            }, {
                name: 'apply-employer',
                percentage: 50,
                activate: function() {
                    document.getElementsByClassName("matomo-PostulerEmployeurAvecMetier")
                        .forEach((elt) => {
                            elt.classList.remove("d-none")
                        });
                }
            }],
            trigger: () => document.getElementsByClassName("matomo-PostulerEmployeurAvecMetier").length,
        }]);
    </script>
{% endblock %}
