{% load badges %}

<div class="c-box mb-3 mb-md-4">
    <div class="row mb-3">
        <div class="col-12 col-sm">
            {% if kind == "IAE" %}
                <h3 class="mb-0">Diagnostic d'éligibilité à l'IAE</h3>
                <span class="text-success fs-sm">
                    Critères validés le {{ eligibility_diagnosis.created_at|date:"d/m/Y" }} par {{ eligibility_diagnosis.author.get_full_name }}
                    {% if eligibility_diagnosis.author_siae %}({{ eligibility_diagnosis.author_siae.display_name }}){% endif %}
                    {% if eligibility_diagnosis.author_prescriber_organization %}
                        ({{ eligibility_diagnosis.author_prescriber_organization.display_name }})
                    {% endif %}
                </span>
            {% elif kind == "GEIQ" %}
                <h3 class="mb-0">Diagnostic public prioritaire GEIQ</h3>
                {% if eligibility_diagnosis.allowance_amount %}
                    <span class="text-success fs-sm">
                        Diagnostic confirmé par {{ eligibility_diagnosis.author.get_full_name }} ({{ eligibility_diagnosis.author_structure.display_name }})
                    </span>
                {% else %}
                    <span class="text-warning fs-sm">
                        Diagnostic non confirmé par {{ eligibility_diagnosis.author.get_full_name }} ({{ eligibility_diagnosis.author_structure.display_name }})
                    </span>
                {% endif %}
            {% endif %}
        </div>
        <div class="col-12 col-sm-auto">
            {% if kind == "IAE" %}
                {% iae_eligibility_badge is_eligible=True extra_classes="badge-sm" %}
            {% elif kind == "GEIQ" %}
                {% if eligibility_diagnosis.allowance_amount %}
                    {% geiq_eligibility_badge is_eligible=True extra_classes="badge-sm" %}
                {% else %}
                    {% geiq_eligibility_badge is_eligible=False extra_classes="badge-sm" %}
                {% endif %}
            {% endif %}
        </div>
    </div>
    <ul class="list-data my-3">
        <li>
            <small>Type</small>
            <strong>{{ eligibility_diagnosis.get_author_kind_display }}</strong>
        </li>
        <li class="align-items-start">
            <small>Critères administratifs</small>
            {# Keep ordering from manager (level then ui_rank) #}
            {% with criteria=eligibility_diagnosis.administrative_criteria.all %}
                {% if not criteria %}
                    <i class="text-disabled">Non renseigné</i>
                {% else %}
                    <ul>
                        {% for criterion in criteria %}<li>{{ criterion.name }}</li>{% endfor %}
                    </ul>
                {% endif %}
            {% endwith %}
        </li>
    </ul>
    {% if kind == "GEIQ" and with_allowance %}
        {% include "apply/includes/geiq/geiq_diagnosis_allowance_alert.html" with diagnosis=eligibility_diagnosis request=request only %}
    {% endif %}
    {% include "apply/includes/administrative_criteria_info.html" with eligibility_diagnosis_expire_at=eligibility_diagnosis.expires_at kind=kind only %}
</div>
