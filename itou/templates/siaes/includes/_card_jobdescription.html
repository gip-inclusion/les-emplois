{% load static %}

{% comment %} takes argument siae <Siae>{% endcomment %}
<div class="card c-card has-links-inside my-4">
    <div class="card-body px-3 pt-0 pb-0">
        <div class="row px-3 pt-3 mt-0 mb-3 bg-light">
            <p class="d-flex flex-wrap w-100 fs-sm">
                <span class="mr-auto w-100 text-primary">
                    {% if job_description.is_from_pole_emploi %}
                        <span class="d-flex flex-wrap justify-content-between w-100">
                            <span class="text-secondary my-2">{{ job_description.market_context_description | default:"Entreprise anonyme" }}</span>
                            {% if job_description.is_pec_offer %}
                                <span class="badge badge-pill badge-small bg-accent-02-lighter font-weight-normal">Réservé au public éligible au contrat PEC</span>
                            {% endif %}
                        </span>
                    {% else %}
                        <a class="matomo-event text-decoration-none btn-link"
                           href="{{ job_description.siae.get_card_url }}?back_url={{ request.get_full_path|urlencode }}"
                           data-matomo-category="candidature"
                           data-matomo-action="clic"
                           data-matomo-option="clic-structure-fichedeposte"
                           target="_blank"
                           aria-label="Ouvrir la page de la structure dans un nouvel onglet">
                            <b>{{ job_description.siae.kind }}</b>&nbsp;- {{ job_description.siae.display_name }}
                            <i class="ri-external-link-line ri-lg"></i>
                        </a>
                    {% endif %}
                </span>
                {% if job_description.siae.kind in ea_eatt_kinds %}
                    <span>
                        <span class="badge badge-base badge-pill badge-xs badge-accent-01-lightest text-accent-01"><b>Priorité aux bénéficiaires de la RQTH</b></span>
                    </span>
                {% endif %}
            </p>
        </div>
        <div class="d-flex justify-content-between w-100">
            <div>
                {% if job_description.is_popular %}
                    <p class="badge badge-sm badge-pill badge-pilotage text-primary mb-3">
                        <i class="ri-group-line mr-1"></i>
                        {{ job_description.POPULAR_THRESHOLD }}+<span class="ml-1">candidatures</span>
                    </p>
                {% endif %}
                <div class="font-weight-bold mb-3">
                    {# Do not use is_external as it might evolve, and do not use a specific property. Covered by a test. #}
                    {% if job_description.is_from_pole_emploi %}
                        <p class="fs-xs mb-1 mt-0">Offre proposée et gérée par pole-emploi.fr</p>
                    {% endif %}
                    <a class="matomo-event"
                       href="{{ job_description.get_absolute_url }}?back_url={{ request.get_full_path|urlencode }}"
                       data-matomo-category="candidature"
                       data-matomo-action="clic"
                       {% if job_description.is_external %} rel="noopener" target="_blank" data-matomo-option="clic-card-fichedeposte-externe" aria-label="Visiter l'offre sur le site d'origine" {% else %} data-matomo-option="clic-card-fichedeposte" aria-label="Aller vers la description de ce poste"  {% endif %}>
                        <span class="h3">{{ job_description.display_name | capfirst }}</span>
                        {% if job_description.is_external %}&nbsp;<i class="ri-external-link-line ri-lg text-secondary"></i>{% endif %}
                    </a>
                </div>
                {% if job_description.display_contract_type or job_description.hours_per_week %}
                    <div class="d-flex flex-wrap mb-3">
                        {% if job_description.display_contract_type %}
                            <div class="d-inline mr-2">
                                <span class="badge badge-xs badge-pill bg-emploi-light text-primary">{{ job_description.display_contract_type }}</span>
                            </div>
                        {% endif %}
                        {% if job_description.hours_per_week %}
                            <div class="d-inline">
                                <span class="badge badge-xs badge-pill bg-emploi-light text-primary">{{ job_description.hours_per_week }}h/semaine</span>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
                <p class="ml-auto fs-sm">
                    <span class="align-self-start">
                        <i class="ri-map-pin-2-line ri-sm"></i>
                        {% if job_description.location %}
                            {{ job_description.location }}
                        {% else %}
                            {{ job_description.siae.city | title }} ({{ job_description.siae.department }})
                        {% endif %}
                    </span>
                    <span class="align-self-start ml-2">
                        <i class="ri-navigation-line ri-sm"></i>&nbsp;à&nbsp;<b>{{ job_description.distance | floatformat:"-1" }}&nbsp;km</b><span class="d-none d-lg-inline">&nbsp;de votre lieu de recherche.</span>
                    </span>
                </p>
            </div>
            {% if job_description.is_from_pole_emploi %}
                <div class="d-none d-lg-flex align-items-center">
                    <img height="35" src="{% static 'img/logo-pole-emploi.svg' %}" alt="Logo Pole Emploi">
                </div>
            {% endif %}
        </div>
    </div>
</div>
