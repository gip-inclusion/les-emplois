{% extends "layout/content_small.html" %}
{% load format_filters %}

{% block title %}{{ job.display_name }} - {{ siae.display_name }}{{ block.super }}{% endblock %}

{% block nb_columns %}8{% endblock %}

{% block breadcrumbs %}
    {% include "layout/breadcrumbs_from_dashboard.html" %}
{% endblock %}

{% block content %}
    <div class="c-box">
        {% include "siaes/includes/_job_description_details.html" %}
        <hr>
        <div>
            {% if can_update_job_description %}
                <div class="row mb-4">
                    <div class="col">
                        <a href="{% url "siaes_views:update_job_description" job_description_id=job.pk %}" class="btn btn-sm btn-outline-primary" arial-label="Modifier la fiche de poste">
                            Modifier
                        </a>
                    </div>
                    <div class="col-auto">
                        <a href="{% url "siaes_views:job_description_list" %}" class="btn btn-sm btn-primary" title="Retour vers la liste des postes">
                            Fermer
                        </a>
                    </div>
                </div>
            {% else %}
                <div class="row mb-4">
                    <div class="col">
                        <a href="#job_description_link" class="btn btn-sm btn-outline-primary" data-toggle="collapse" title="Partager cette fiche métier">Partager cette fiche métier</a>
                        <div class="collapse pt-2" id="job_description_link">
                            <p class="small mb-1">Copiez-collez le lien ci-dessous :</p>
                            <input type="text" class="form-control form-control-sm" value="{{ request.scheme }}://{{ request.get_host }}{{ job.get_absolute_url }}" onClick="this.select()">
                        </div>
                    </div>
                    {% if job.is_active and not siae.block_job_applications %}
                        <div class="col-auto">
                            <a href="{% url "apply:start" siae_pk=siae.pk %}?job_description_id={{ job.pk }}"
                               class="matomo-event btn btn-sm btn-primary"
                               data-matomo-category="candidature"
                               data-matomo-action="clic"
                               data-matomo-option="clic-metiers"
                               title="Postuler auprès de l'employeur solidaire {{ siae.display_name }}">
                                Postuler
                            </a>
                        </div>
                    {% endif %}
                </div>

                {% if others_active_jobs and not siae.block_job_applications %}
                    <hr>
                    <h2 class="h2">
                        Consulter le{{ others_active_jobs|pluralize }} recrutement{{ others_active_jobs|pluralize }} en cours dans cette structure
                    </h2>
                    <ul class="list-group list-group-flush mb-4">
                        {% for other_job in others_active_jobs %}
                            {% include "siaes/includes/_list_siae_actives_jobs_row.html" with job=other_job %}
                        {% endfor %}
                    </ul>
                {% endif %}

                {% if back_url %}
                    <hr>
                    <a href="{{ back_url }}" class="btn btn-link btn-ico pl-0" title="Retour à l'étape précédente">
                        <i class="ri-arrow-go-back-line ri-lg"></i>
                        <span>Retour</span>
                    </a>
                {% endif %}
            {% endif %}
        </div>
    </div>
{% endblock %}
