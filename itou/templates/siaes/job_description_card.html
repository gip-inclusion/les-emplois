{% extends "layout/base.html" %}
{% load format_filters %}
{% load str_filters %}

{% block title %}{{ job.display_name }} - {{ siae.display_name }} {{ block.super }}{% endblock %}

{% block nb_columns %}8{% endblock %}

{% block breadcrumbs %}
    {% include "layout/breadcrumbs_from_dashboard.html" %}
{% endblock %}

{% block content_title %}<h1>Description du poste</h1>{% endblock %}

{% block content %}
    <section class="s-section">
        <div class="s-section__container container">
            <div class="row">
                <div class="col-12 col-lg-8">
                    <div class="c-box">
                        {% include "siaes/includes/_job_description_details.html" %}
                        <hr>
                        <div>
                            {% if can_update_job_description %}
                                <div class="row mb-4">
                                    <div class="col">
                                        <a href="{% url "siaes_views:update_job_description" job_description_id=job.pk %}" class="btn btn-sm btn-outline-primary" aria-label="Modifier la fiche de poste">
                                            Modifier
                                        </a>
                                    </div>
                                    <div class="col-auto">
                                        <a href="{% url "siaes_views:job_description_list" %}" class="btn btn-sm btn-primary" aria-label="Retour vers la liste des postes">
                                            Fermer
                                        </a>
                                    </div>
                                </div>
                            {% else %}
                                <div class="row mb-4">
                                    <div class="col">
                                        <a href="#job_description_link" class="btn btn-sm btn-outline-primary" data-toggle="collapse" aria-label="Partager cette fiche métier">Partager cette fiche métier</a>
                                        <div class="collapse pt-2" id="job_description_link">
                                            <p class="small mb-1">Cliquez sur le lien ci-dessous pour le copier:</p>
                                            <input type="text" class="form-control form-control-sm" value="{{ request.scheme }}://{{ request.get_host }}{{ job.get_absolute_url }}">
                                        </div>
                                    </div>
                                    {% if job.is_active and not siae.block_job_applications %}
                                        <div class="col-auto text-right">
                                            <a href="{% url "apply:start" siae_pk=siae.pk %}?job_description_id={{ job.pk }}"
                                               class="matomo-event btn btn-sm btn-primary"
                                               data-matomo-category="candidature"
                                               data-matomo-action="clic"
                                               data-matomo-option="clic-metiers"
                                               aria-label="Postuler auprès de l'employeur solidaire {{ siae.display_name }}">
                                                Postuler
                                            </a>
                                        </div>
                                    {% endif %}
                                </div>

                                {% if others_active_jobs and not siae.block_job_applications %}
                                    <hr>
                                    <h2 class="h2">
                                        Consulter le{{ others_active_jobs|pluralizefr }} recrutement{{ others_active_jobs|pluralizefr }} en cours dans cette structure
                                    </h2>
                                    <ul class="list-group list-group-flush mb-4">
                                        {% for other_job in others_active_jobs %}
                                            {% include "siaes/includes/_list_siae_actives_jobs_row.html" with job=other_job %}
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block script %}
    {{ block.super }}
    <script nonce="{{ CSP_NONCE }}">
        document.getElementById('job_description_link').addEventListener("click", function select(event) {
            var input = event.target;
            input.select();
            navigator.clipboard.writeText(input.value);
        });
    </script>
{% endblock %}
