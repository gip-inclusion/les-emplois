{% load static %}
{% load theme_inclusion %}
{% load bootstrap4 %}
<!DOCTYPE HTML>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>
            {% block title %}- Les emplois de l'inclusion{% endblock %}
        </title>
        {% block meta_description %}
            <meta name="description"
                  content="Les emplois de l'inclusion facilitent le retour à l'emploi des personnes en situation d'exclusion par l'orientation et le recrutement auprès d'employeurs solidaires (structures de l'insertion par l'activité économique et du secteur adapté)">
        {% endblock %}
        <meta name="viewport" content="width=device-width, initial-scale=1">

        {# https://metatags.io #}
        <meta name="title" content="Les emplois de l'inclusion">
        {# Project uses custom styles for indicators, CSP compatibility #}
        <meta name="htmx-config" content='{"includeIndicatorStyles": false, "allowScriptTags":false}'>
        {# https://metatags.io Open Graph / Facebook #}
        <meta property="og:type" content="website">
        <meta property="og:url" content="{{ ITOU_PROTOCOL }}://{{ ITOU_FQDN }}">
        <meta property="og:title" content="Les emplois de l'inclusion">
        <meta property="og:description"
              content="Les emplois de l'inclusion facilitent le retour à l'emploi des personnes en situation d'exclusion par l'orientation et le recrutement auprès d'employeurs solidaires (structures de l'insertion par l'activité économique et du secteur adapté)">
        <meta property="og:image" content="{{ ITOU_PROTOCOL }}://{{ ITOU_FQDN }}{% static "img/logo_metatags.png" %}">
        {# https://metatags.io Twitter #}
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="{{ ITOU_PROTOCOL }}://{{ ITOU_FQDN }}">
        <meta property="twitter:title" content="Les emplois de l'inclusion">
        <meta property="twitter:description"
              content="Les emplois de l'inclusion facilitent le retour à l'emploi des personnes en situation d'exclusion par l'orientation et le recrutement auprès d'employeurs solidaires (structures de l'insertion par l'activité économique et du secteur adapté)">
        <meta property="twitter:image" content="{{ ITOU_PROTOCOL }}://{{ ITOU_FQDN }}{% static "img/logo_metatags.png" %}">

        <link rel="shortcut icon" href="{% static_theme_images "favicon.ico" %}" type="image/ico">
        <link rel="stylesheet" href="{% static "vendor/jquery-ui/jquery-ui.min.css" %}" type="text/css">
        <link rel="stylesheet" href="{% static "vendor/theme-inclusion/stylesheets/app.css" %}" type="text/css">
        <link rel="stylesheet" href="{% static "css/itou.css" %}" type="text/css">
        {% block extra_head %}{% endblock %}
    </head>
    <body class="{% block body_class %}{% endblock %}">
        <nav role="navigation" aria-label="Accès rapide" tabindex="0" class="visually-hidden">
            <ul>
                <li>
                    <a href="#nav-primary">Aller au menu principal</a>
                </li>
                <li>
                    <a href="#main">Aller au contenu principal</a>
                </li>
            </ul>
        </nav>

        {% include "includes/demo_accounts.html" %}
        {% include "layout/_header.html" %}

        <main id="main" role="main" class="s-main bg-light">
            <div class="toast-container" aria-live="polite" aria-atomic="true">{% include "utils/toasts.html" %}</div>
            <div class="container container-messages">
                {% block messages %}

                    {% bootstrap_messages %}

                    {# Display an alert for old browsers #}
                    <div class="alert alert-secondary alert-old-browser" role="status">
                        <p class="mb-0">
                            La version de votre navigateur n'est plus supportée. Veuillez utiliser une version plus récente pour améliorer votre expérience sur notre site.
                        </p>
                    </div>
                {% endblock %}
            </div>

            <div class="container container-breadcrumb">
                {% block breadcrumbs %}{% endblock %}
            </div>

            {% comment %}
            Si les templates enfants ont besoin d'une section <section .s-title-01>, penser à mettre le contenu dans le {% block content_title %}{% endblock %}
            Sinon, penser à mettre le {% block content_title_wrapper %}{% endblock %} vide dans ces templates pour vider le DOM "enrobant" ci-dessous
            {% endcomment %}
            {% block content_title_wrapper %}
                <section class="s-title-01">
                    <div class="s-title-01__container container">
                        <div class="s-title-01__row row">
                            <div class="s-title-01__col col-12">
                                {% block content_title %}{% endblock %}
                            </div>
                        </div>
                    </div>
                </section>
            {% endblock %}

            {% block content %}{% endblock %}
        </main>

        {% include "layout/_footer.html" %}

        <div class="visually-hidden">
            <a href="#header">Retour au début de la page</a>
        </div>

        <script src="{% static "vendor/jquery/jquery.min.js" %}"></script>
        <script src="{% static "vendor/bootstrap/popper.min.js" %}"></script>
        <script src="{% static "vendor/bootstrap/bootstrap.min.js" %}"></script>
        <script src="{% static "vendor/duetds-date-picker/duet.js" %}"></script>
        <script src="{% static "vendor/tarteaucitron/tarteaucitron.js" %}"></script>
        <script src="{% static "vendor/jquery-ui/jquery-ui.min.js" %}"></script>
        <script src="{% static "vendor/theme-inclusion/javascripts/app.js" %}"></script>


        <script nonce="{{ CSP_NONCE }}">
            // Tarteaucitron's language is set according to the browser configuration
            // but a lot of users don't know how to change it.
            // This can be forced only by using a global `var` statement.
            // https://github.com/AmauriC/tarteaucitron.js/blob/98b02b0bdda670bd953752d85443c3fd77dde724/tarteaucitron.js#L5
            var tarteaucitronForceLanguage = "fr";

            /* beautify ignore:start */
            tarteaucitron.init({
                "privacyUrl": "", /* Privacy policy url */
                "bodyPosition": "bottom", /* or top to bring it as first element for accessibility */
                "hashtag": "#tarteaucitron", /* Open the panel with this hashtag */
                "cookieName": "tarteaucitron", /* Cookie name */
                "orientation": "bottom", /* Banner position (top - bottom) */
                "groupServices": false, /* Group services by category */
                "serviceDefaultState": "wait", /* Default state (true - wait - false) */
                "showAlertSmall": false, /* Show the small banner on bottom right */
                "cookieslist": false, /* Show the cookie list */
                "closePopup": false, /* Show a close X on the banner */
                "showIcon": true, /* Show cookie icon to manage cookies */
                //"iconSrc": "", /* Optionnal: URL or base64 encoded image */
                "iconPosition": "BottomLeft", /* BottomRight, BottomLeft, TopRight and TopLeft */
                "adblocker": false, /* Show a Warning if an adblocker is detected */
                "DenyAllCta" : true, /* Show the deny all button */
                "AcceptAllCta" : true, /* Show the accept all button when highPrivacy on */
                "highPrivacy": true, /* HIGHLY RECOMMANDED Disable auto consent */
                "handleBrowserDNTRequest": false, /* If Do Not Track == 1, disallow all */
                "removeCredit": true, /* Remove credit link */
                "moreInfoLink": true, /* Show more info link */
                "useExternalCss": true, /* If false, the tarteaucitron.css file will be loaded */
                "useExternalJs": false, /* If false, the tarteaucitron.js file will be loaded */
                //"cookieDomain": ".my-multisite-domaine.fr", /* Shared cookie for multisite */
                "readmoreLink": "{% url 'legal-privacy' %}#cookies", /* Change the default readmore link */
                "mandatory": true, /* Show a message about mandatory cookies */
                "mandatoryCta": true /* Show the disabled accept button when mandatory on */
            });

            // Hotjar.
            (tarteaucitron.job = tarteaucitron.job || []).push('hotjar');
            {% if ITOU_ENVIRONMENT == "PROD" %}tarteaucitron.user.hotjarId = 2360441;{% endif %}
            {% if ITOU_ENVIRONMENT == "DEMO" %}tarteaucitron.user.hotjarId = 1861487;{% endif %}
            tarteaucitron.user.HotjarSv = 6;

            {% if MATOMO_BASE_URL %}
            // Matomo :
            tarteaucitron.user.matomoId = {{ MATOMO_SITE_ID }};
            tarteaucitron.user.matomoHost = '{{ MATOMO_BASE_URL }}';
            (tarteaucitron.job = tarteaucitron.job || []).push('matomo');
            {% endif %}
            /* beautify ignore:end */

            // livestorm
            const tablet_width = 750;
            tarteaucitron.services.livestorm = {
                "key": "livestorm",
                "type": "video",
                "name": "Livestorm",
                "uri": "https://livestorm.co/fr/politique-confidentialite",
                "needConsent": true,
                "cookies": [],
                "js": function() {
                    "use strict";
                    tarteaucitron.fallback(['js-tac-livestorm'], function(x) {
                        var frame_title = tarteaucitron.fixSelfXSS(x.getAttribute("title") || 'livestorm iframe'),
                            width = x.getAttribute("width"),
                            height = x.getAttribute("height"),
                            url = x.getAttribute("data-url");

                        // Poor attempt to make the Livestorm iframe responsive.
                        if (document.body.clientWidth > tablet_width) {
                            height = "365px";
                        }
                        return '<iframe title="' + frame_title + '" src="' + url + '" style="min-height:' + height + ';" allowtransparency allowfullscreen></iframe>';
                    });
                },
                "fallback": function() {
                    "use strict";
                    var id = 'livestorm';
                    tarteaucitron.fallback(['js-tac-livestorm'], function(elem) {
                        elem.style.width = elem.getAttribute('width');
                        if (document.body.clientWidth > tablet_width) {
                            elem.style.height = "310px";
                        } else {
                            elem.style.height = elem.getAttribute('height');
                        }
                        return tarteaucitron.engage(id);
                    });
                }
            };
            (tarteaucitron.job = tarteaucitron.job || []).push('livestorm');
        </script>

        {% block script %}
            <script src="{% static "vendor/htmx/htmx.min.js" %}"></script>
            {% if debug %}
                <script src="{% static "vendor/htmx/ext/debug.js" %}"></script>
                <script src="{% static "vendor/htmx/ext/event-header.js" %}"></script>
            {% endif %}
            <script src="{% static "js/htmx_handlers.js" %}"></script>
            <script src="{% static "js/modal_control.js" %}"></script>
            <script src="{% static "js/city_autocomplete_field.js" %}"></script>
            <script src="{% static "js/commune_autocomplete_field.js" %}"></script>
            <script src="{% static "js/prevent_multiple_submit.js" %}"></script>
            <script src="{% static 'js/utils.js'%}"></script>
            <script src="{% static "js/duet_date_picker_widget.js" %}"></script>

            {% if SHOW_DEMO_ACCOUNTS_BANNER %}
                <script src="{% static 'js/demo_accounts.js'%}"></script>
            {% endif %}

            <script nonce="{{ CSP_NONCE }}">
                // Show any toasts that is already present in the DOM
                htmx.onLoad(() => {
                    $(".toast-placement-wrapper").children(".toast").each(function() {
                        $(this).toast("show");
                    });
                });
            </script>

        {% endblock %}

        {% if MATOMO_BASE_URL %}
            {# Matomo/Piwik open source web analytics #}
            <script id="matomo-custom-init" nonce="{{ CSP_NONCE }}">
                /* beautify ignore:start */
                window._paq = window._paq || [];
                /* tracker methods like "setCustomDimension" should be called before "trackPageView" */

                {% if matomo_user_id %}window._paq.push(['setUserId', '{{ matomo_user_id }}']);{% endif %}

                {% if matomo_custom_url %}
                    window._paq.push(['setCustomUrl', new URL('{{ matomo_custom_url }}', window.location.origin).href]);
                {% endif %}

                {% if matomo_custom_title %}
                    window._paq.push(['setDocumentTitle', '{{ matomo_custom_title }}']);
                {% else %}
                    /* defaults to a stripped version (no suffix) of the page title. */

                    const title = document.title.replace(/- Les emplois de l'inclusion/g,'').trim();
                    window._paq.push(['setDocumentTitle', title]);
                {% endif %}
                /* beautify ignore:end */
            </script>
            <script src="{% static "js/matomo.js" %}"></script>
        {% endif %}


        {# Display "Je donne mon avis" only on HP. #}
        {# The rationale behind it: "Je donne mon avis" is imposed by DINUM but is redundant with Hotjar. #}
        {# Hotjar is way more powerful. Compromise: display "Je donne mon avis" only on HP. #}
        {% if request.path == "/" %}
            <div class="fixed-sm-bottom text-center text-sm-right p-3 pe-sm-2 pb-sm-2">
                <a href="https://voxusagers.numerique.gouv.fr/Demarches/2436?&view-mode=formulaire-avis&nd_mode=en-ligne-enti%C3%A8rement&nd_source=button&key=ca117c905602fb63fda68b31ee0f5bdd" target="_blank">
                    <img class="give-my-advice" src="{% static 'img/je-donne-mon-avis.svg' %}" alt="Je donne mon avis sur cette démarche">
                </a>
            </div>
        {% else %}
            {# Sticky FAQ link is not displayed on HP and on small devices #}
            <div class="rounded-pill bg-white shadow fixed-sm-bottom d-none d-sm-inline-block m-4 py-2 px-3 text-center text-md-right">
                <a href="{{ ITOU_HELP_CENTER_URL }}" rel="noopener" target="_blank" class="has-external-link text-decoration-none" aria-label="Besoin d'aide ? (ouverture dans un nouvel onglet)">
                    Besoin d'aide ?
                </a>
            </div>
        {% endif %}

    </body>
</html>
