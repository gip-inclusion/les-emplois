{% load job_applications %}
<div class="fs-sm d-flex flex-column flex-md-row align-items-center mb-3">
    <span class="text-secondary order-2 order-md-1 me-auto">
        Émise le {{ job_application.created_at|date:"d F Y" }} par

        {% if request.user == job_application.sender %}
            <strong>Vous</strong>
        {% elif job_application.sender_kind == SenderKind.JOB_SEEKER %}
            <i class="ri-user-line mr-2" aria-hidden="true"></i><strong>Le candidat lui-même</strong>
        {% elif job_application.sender_kind == SenderKind.EMPLOYER %}
            <strong class="mr-2">{{ job_application.sender_siae.display_name }}</strong>
            {% if request.user.is_employer %}
                {% if job_application.origin == JobApplicationOrigin.PE_APPROVAL %}
                    <i class="ri-community-line me-2" aria-hidden="true"></i>Employeur (Import agrément Pôle emploi)
                {% else %}
                    <i class="ri-community-line me-2" aria-hidden="true"></i>Employeur (Auto-prescription)
                {% endif %}
            {% endif %}
        {% elif job_application.sender_kind == SenderKind.PRESCRIBER %}
            {% if job_application.sender_prescriber_organization %}
                <strong class="me-2">{{ job_application.sender_prescriber_organization.display_name }}</strong>
            {% else %}
                <strong class="me-2">{{ job_application.sender.get_full_name }}</strong>
            {% endif %}
            {% if job_application.is_sent_by_authorized_prescriber %}
                <i class="ri-group-line me-2" aria-hidden="true"></i>Prescripteur habilité
            {% else %}
                <i class="ri-group-line me-2" aria-hidden="true"></i>Orienteur
            {% endif %}
        {% endif %}
        {% if request.user.is_prescriber %}
            chez <a href="{% url 'companies_views:card' siae_id=job_application.to_company.id %}"><strong>{{ job_application.to_company.display_name }}</strong></a>
        {% endif %}

    </span>
    {# élément à passer au dessus du précédent en vue mobile #}
    <span class="order-1 order-md-2 ms-auto">{% state_badge job_application %}</span>
</div>
<hr class="my-3">
{% with all_jobs=job_application.selected_jobs.all %}
    <div>
        {% if all_jobs|length == 0 %}
            <i class="ri-briefcase-line ri-xl me-1"></i><span class="font-weight-bold me-1 me-md-2">Candidature spontanée</span>
        {% elif all_jobs|length == 1 %}
            {% with job=all_jobs.0 %}
                <i class="ri-briefcase-line ri-xl me-1"></i>
                <span class="font-weight-bold me-1 me-md-2">{{ job.display_name }}</span>
                {% if job.location %}
                    <span class="fs-sm text-nowrap">
                        <i class="ri-map-pin-2-line ri-sm me-1"></i>
                        {{ job.location }}
                    </span>
                {% endif %}
            {% endwith %}
        {% else %}
            <a class="d-flex flex-wrap align-items-center text-decoration-none has-collapse-caret collapsed"
               data-bs-toggle="collapse"
               href="#collapse-job-application-{{ job_application.id }}"
               role="button"
               aria-expanded="false"
               aria-controls="collapse-job-application-{{ job_application.id }}">
                <i class="ri-briefcase-line ri-xl me-1"></i>
                <span class="font-weight-bold me-1 me-md-2">Voir les {{ all_jobs|length }} postes</span>
            </a>
            <ul class="list-group list-group-sm list-group-flush collapse" id="collapse-job-application-{{ job_application.id }}">
                {% for job in all_jobs %}
                    <li class="list-group-item list-group-item-action">
                        <span class="d-flex flex-wrap align-items-center text-decoration-none">
                            <span class="font-weight-bold me-1 me-md-2">{{ job.display_name }}</span>

                            {% if job.location %}
                                <span class="ms-auto fs-sm text-nowrap">
                                    <i class="ri-map-pin-2-line ri-sm me-1"></i>
                                    {{ job.location }}
                                </span>

                            {% endif %}
                        </span>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
{% endwith %}
